import{_ as R}from"./ConfirmDeleteModal.vue_vue_type_script_setup_true_lang-Bze5fObe.js";import{u as A,a as I,_ as V,d as j,B as N,e as E,s as O,f as B}from"./useVariationTableMapper-5ca8EiQP.js";import{d as k,g as L,C as S,c as h,e as r,l as i,q as d,B as u,z as l,u as s,x as y,y as f,I as $,F as P,o as _,_ as M,m as C,a3 as H,a5 as z,G as U,H as q}from"./index-CJz8f9ss.js";import{g as F}from"./usePartnerDetails--U1EepqX.js";import{n as G}from"./priceUtils-1yxS_Q4Z.js";function T(e){return e.toLocaleDateString()}function D(e){return G(e)}function K(e){const t=J(e);W(t,`${e.orderNumber}-printlist.csv`)}function J(e){return e.items.length?[["MODEL","Size"].join(","),...e.items.flatMap(a=>Q(a))].join(`
\r`):""}function Q(e){const t=`${e.sku.productCode}${e.sku.getSnapshotValues(["size"]).join(" ")}`,o=e.sku.size,a=`${t}, ${o}`;return Array(e.quantity).fill(a)}function W(e,t="export.csv"){const o=new Blob([e],{type:"text/csv;charset=utf-8;"}),a=URL.createObjectURL(o),n=document.createElement("a");n.href=a,n.setAttribute("download",t),document.body.appendChild(n),n.click(),document.body.removeChild(n),URL.revokeObjectURL(a)}const X={class:"mr-2"},Y={key:0,class:"text-subtitle-1 text-grey-darken-1 order-details-line"},Z={key:1,class:"text-subtitle-1 text-grey-darken-1 order-details-line"},ee={class:"text-subtitle-1 text-grey-darken-1 font-weight-bold order-details-line"},te={class:"formatted-notes"},ne={class:"text-h5 font-weight-bold"},oe={key:0},re={key:0},se=k({__name:"OrderDetailsHeader",props:{order:{}},setup(e){const{tCap:t}=L(),o=P(),{deleteOrderCommmandHandler:a}=A(),n=e,m=S(()=>F(n.order.partnerId));function c(){return`#${n.order.orderNumber}`}function p(){o.back(),a.handle({id:n.order.id})}return(w,g)=>{const v=i("v-col"),x=i("v-btn"),b=i("v-row");return _(),h($,null,[r(b,{align:"start",justify:"space-between",dense:""},{default:d(()=>[r(v,{cols:"5",class:"d-flex",justify:"start"},{default:d(()=>[u("h1",X,l(c()),1),r(I,{status:e.order.status,class:"ml-2 mt-2"},null,8,["status"]),r(V,{type:e.order.type,class:"ml-2 mt-2"},null,8,["type"])]),_:1}),r(v,{cols:"4",class:"d-flex flex-row justify-end"}),r(v,{cols:"1",class:"d-flex flex-row justify-end"},{default:d(()=>[r(R,{name:c(),"action-fn":()=>p(),mini:""},null,8,["name","action-fn"]),r(x,{variant:"text",icon:"mdi-file-delimited",onClick:g[0]||(g[0]=be=>s(K)(e.order))})]),_:1})]),_:1}),r(b,{align:"start",justify:"space-between",dense:""},{default:d(()=>[r(v,{cols:"3",class:"text-md-left"},{default:d(()=>[m.value?(_(),h("div",Y,[u("strong",null,l(s(t)("partner.customer")),1),g[1]||(g[1]=f(": ",-1)),r(x,{variant:"text",to:`/partner/${m.value.id}`},{default:d(()=>[f(l(m.value.businessName),1)]),_:1},8,["to"])])):y("",!0),e.order.dueDate?(_(),h("div",Z,[u("strong",null,l(s(t)("order.dueDate")),1),f(": "+l(s(T)(e.order.dueDate)),1)])):y("",!0),u("div",ee,l(s(t)("order.notes"))+": ",1),u("span",te,l(e.order.notes),1)]),_:1}),r(v,{cols:"4",md:"5",class:"text-md-right"},{default:d(()=>[u("span",null,l(s(t)("order.total")),1),u("div",ne,l(s(D)(e.order.totalAmount)),1),u("div",null,[f(l(s(t)("order.orderSum"))+" ",1),u("strong",null,l(s(D)(e.order.subtotal)),1),f(" · "+l(s(t)("order.vatRate"))+" ",1),u("strong",null,l(s(D)(e.order.taxAmount)),1),e.order.discountAmount>0?(_(),h("span",oe,[f(" · "+l(s(t)("order.discount"))+" ",1),u("strong",null,l(s(D)(e.order.discountAmount)),1)])):y("",!0)]),e.order.depositAmount>0?(_(),h("div",re,[f(l(s(t)("order.deposit"))+" ",1),u("strong",null,l(s(D)(e.order.discountAmount)),1),f(" · "+l(s(t)("order.remainingAmount"))+" ",1),u("strong",null,l(s(D)(e.order.remainingAmount)),1)])):y("",!0)]),_:1})]),_:1})],64)}}}),ae=M(se,[["__scopeId","data-v-7dbfab72"]]),le=k({__name:"DisplayTable",props:{tableRows:{},tableColumns:{},hideRowIndex:{type:Boolean}},setup(e){const t=e,o=S(()=>j(t.tableRows));return(a,n)=>(_(),C(N,{modelValue:o.value,"table-columns":e.tableColumns,"hide-row-index":e.hideRowIndex},null,8,["modelValue","table-columns","hide-row-index"]))}});function de(e){const t=e.map(ce);return ie(t)}function ce(e){const t=e.sku.variationSnapshot.attributes??{},{size:o,...a}=t;return{name:e.name,unitPrice:e.unitPrice,productCode:e.productCode,derivedSku:H(e.productCode,{attributes:a,flags:e.sku.variationSnapshot.flags}),variationSnapshot:{attributes:a,flags:e.sku.variationSnapshot.flags},sizing:ue(o,e.quantity)}}function ie(e){const t=new Map;for(const o of e){const a=o.derivedSku,n=t.get(a);if(n)for(const[m,c]of Object.entries(o.sizing))n.sizing[m]=(n.sizing[m]||0)+c;else t.set(a,{...o,sizing:{...o.sizing}})}return[...t.values()]}function ue(e,t){return{[`shoe:${e}`]:t}}const me=k({__name:"OrderDetailsLineItems",props:{order:{}},setup(e){const{tCap:t}=L(),{vmToRows:o}=E(O),a=e,n=S(()=>{const m=de([...a.order.items]);return o(m)});return(m,c)=>{const p=i("v-chip"),w=i("v-list-item"),g=i("v-card-title"),v=i("v-card-text"),x=i("v-card");return _(),C(x,null,{default:d(()=>[r(g,null,{default:d(()=>[r(w,null,{title:d(()=>[u("h3",null,l(s(t)("order.items",2)),1)]),append:d(()=>[r(p,{size:"small"},{default:d(()=>[f(l(e.order.items.length),1)]),_:1})]),_:1})]),_:1}),r(v,null,{default:d(()=>[r(le,{tableRows:n.value,"table-columns":s(O)},null,8,["tableRows","table-columns"])]),_:1})]),_:1})}}});function _e(e){const{tCap:t}=L(),o=[{name:t("order.createdDate"),getDate:n=>n.createdDate},{name:t("order.approvedDate"),getDate:n=>n.approvedDate},{name:t("order.shippedDate"),getDate:n=>n.shippedDate},{name:t("order.completedDate"),getDate:n=>n.completedDate}],a={name:t("order.cancelledDate"),getDate:n=>n.cancelledDate,isCancelled:!0};return{timelineItems:S(()=>fe(e.value,o,a))}}function fe(e,t,o){const a=[...t];e.status===z.Cancelled&&a.push(o);const n=a.map(c=>({name:c.name,date:c.getDate(e)})),m=n.map(c=>c.date).findLastIndex(c=>c!==void 0);return n.map((c,p)=>e.status===z.Cancelled&&c.name==="Cancelled"?{...c,colour:"red"}:c.date?{...c,colour:p===m?"indigo":"cyan"}:{...c,colour:"grey"})}const pe={class:"d-flex"},ve={key:0,class:"me-4"},ge=k({__name:"OrderDetailsTimeline",props:{order:{}},setup(e){const{tCap:t}=L(),o=e,{timelineItems:a}=_e(U(o,"order"));return(n,m)=>{const c=i("v-card-title"),p=i("v-divider"),w=i("v-timeline-item"),g=i("v-timeline"),v=i("v-card-text"),x=i("v-card");return _(),C(x,null,{default:d(()=>[r(c,null,{default:d(()=>[f(l(s(t)("common.timeline")),1)]),_:1}),r(p),r(v,null,{default:d(()=>[r(g,{align:"start",side:"end",direction:"horizontal"},{default:d(()=>[(_(!0),h($,null,q(s(a),b=>(_(),C(w,{"dot-color":b.colour,size:"small"},{opposite:d(()=>[u("div",null,l(b.name),1)]),default:d(()=>[u("div",pe,[b.date?(_(),h("strong",ve,l(s(T)(b.date)),1)):y("",!0)])]),_:2},1032,["dot-color"]))),256))]),_:1})]),_:1})]),_:1})}}}),ke=k({__name:"OrderDetails",props:{id:{}},setup(e){const t=e,{model:o}=B(t.id);return(a,n)=>{const m=i("v-col"),c=i("v-row"),p=i("v-container");return s(o)?(_(),C(p,{key:0},{default:d(()=>[r(ae,{order:s(o)},null,8,["order"]),r(c,{class:"mt-6",align:"start"},{default:d(()=>[r(m,{cols:"12"},{default:d(()=>[r(me,{order:s(o)},null,8,["order"])]),_:1}),r(m,{cols:"12",md:"12",xl:"12"},{default:d(()=>[r(ge,{order:s(o)},null,8,["order"])]),_:1})]),_:1})]),_:1})):y("",!0)}}});export{ke as default};
