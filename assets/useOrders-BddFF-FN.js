import{a7 as L,C as b,ac as B,a4 as Y,$ as h,d as k,g as U,m as _,l as T,u as C,q as z,y as ee,z as R,o as u,c as y,a0 as F,_ as q,r as K,a as N,n as te,w as de,G as me,x,B as E,e as O,H as M,I as j,a1 as Q,a3 as pe,ae as H,af as ne,a9 as G,ag as fe,ah as X,ai as ye,Z as he}from"./index-1h5CSaCC.js";import{s as be,b as Z}from"./priceUtils-Dq5SYNCJ.js";function gt(e){const t=L(),n=b(()=>t.getOrderById(e)),r=b(()=>{const o=n.value;if(o)return B.toModel(o)});return{dto:n,model:r}}function ge(e){switch(e){case h.Draft:return"indigo";case h.Cancelled:return"red";case h.Approved:case h.Processing:case h.ReadyForShipment:case h.Shipped:return"warning";case h.Completed:default:return"grey"}}function ve(e,t){switch(e){case h.Draft:return t("order.draft");case h.Cancelled:return t("order.cancelled");case h.Approved:return t("order.approved");case h.Processing:return t("order.processing");case h.ReadyForShipment:return t("order.readyForShipment");case h.Shipped:return t("order.shipped");case h.Completed:return t("order.completed")}}function we(e,t){switch(e){case Y.Sales:return t("order.sales");case Y.Purchase:return t("order.purchase")}}const vt=k({__name:"StatusChip",props:{status:{}},setup(e){const{tCap:t}=U();return(n,r)=>{const o=T("v-chip");return u(),_(o,{color:C(ge)(e.status)},{default:z(()=>[ee(R(C(ve)(e.status,C(t))),1)]),_:1},8,["color"])}}}),wt=k({__name:"OrderTypeChip",props:{type:{}},setup(e){const{tCap:t}=U();return(n,r)=>{const o=T("v-chip");return u(),_(o,{variant:"outlined"},{default:z(()=>[ee(R(C(we)(e.type,C(t))),1)]),_:1})}}});function Te(e){return e.map(t=>({id:t.id,cells:t.cells.map(n=>({value:n}))}))}function Tt(e){return e.map(t=>({id:t.id,cells:t.cells.map(n=>n.value)}))}const Ce=k({__name:"TextRenderer",props:{modelValue:{},width:{}},setup(e){return(t,n)=>(u(),y("span",{class:"text-renderer",style:F({width:e.width||"1vw"})},R(e.modelValue),5))}}),Se=q(Ce,[["__scopeId","data-v-1a107f6e"]]),xe=k({__name:"PriceRenderer",props:{modelValue:{},width:{}},setup(e){const t=e,n=b(()=>be(t.modelValue));return(r,o)=>(u(),y("span",{class:"price-renderer",style:F({width:e.width||"2vw"})},R(n.value),5))}}),Oe=q(xe,[["__scopeId","data-v-2b15d027"]]);var V=(e=>(e[e.Up=0]="Up",e[e.Down=1]="Down",e[e.Left=2]="Left",e[e.Right=3]="Right",e))(V||{});function ke(e,t={}){const{allowArrowNavigation:n=!0}=t;function r(o){let a=null;switch(o.key){case"Enter":a=o.shiftKey?V.Up:V.Down;break;case"Tab":a=o.shiftKey?V.Left:V.Right;break}a&&(o.preventDefault(),o.stopPropagation(),e("navigate",a))}return{onKeydown:r}}function Ct(){const e=K(null);N(()=>t());async function t(){await te(),e.value?.$el?.querySelector("input")?.focus()}return{fieldRef:e}}function ze(e){const t=K(null);N(()=>n()),de(()=>e.value,r=>{r&&n()});async function n(){await te(),t.value?.$el?.querySelector('input[type="checkbox"]')?.focus()}return{checkboxRef:t}}const _e=k({__name:"CheckboxRenderer",props:{modelValue:{},width:{},readonly:{type:Boolean},focusKey:{}},emits:["update:modelValue","blur","navigate"],setup(e,{emit:t}){const n=e,r=t,{onKeydown:o}=ke(r);function a(l){switch(l.key){case" ":l.preventDefault(),r("update:modelValue",!n.modelValue);return;case"Enter":l.preventDefault(),r("navigate",V.Down);return}o(l)}const{checkboxRef:c}=ze(me(n,"focusKey"));return(l,d)=>{const g=T("v-checkbox");return u(),_(g,{ref_key:"checkboxRef",ref:c,"model-value":!!e.modelValue,"onUpdate:modelValue":d[0]||(d[0]=m=>l.$emit("update:modelValue",m)),density:"compact","hide-details":"",tabindex:"0",onKeydown:a,style:F({width:e.width||"1vw"}),readonly:e.readonly},null,8,["model-value","style","readonly"])}}}),Ve={text:Se,price:Oe,checkbox:_e},Re={key:0},Le={key:1},Pe={key:2},Ie={key:0},$e={key:1},Ae={key:2},Ke=k({__name:"BaseTable",props:{modelValue:{},tableColumns:{},hideRowIndex:{type:Boolean},selectable:{type:Boolean},selectedKeys:{},rowKey:{type:Function}},emits:["toggle-row","toggle-all"],setup(e,{emit:t}){const n=e,r=t;function o(l,d,g){return d.calculate?d.calculate(l):g}const a=b(()=>n.selectedKeys&&n.modelValue.length>0&&n.selectedKeys.size===n.modelValue.length),c=b(()=>n.selectedKeys&&n.selectedKeys.size>0&&n.selectedKeys.size<n.modelValue.length);return(l,d)=>{const g=T("v-checkbox"),m=T("v-table");return e.tableColumns.length>0?(u(),_(m,{key:0,class:"base-table",density:"compact",striped:"even"},{default:z(()=>[E("thead",null,[E("tr",null,[e.selectable?(u(),y("th",Re,[O(g,{density:"compact","hide-details":"","model-value":a.value,indeterminate:c.value,"onUpdate:modelValue":d[0]||(d[0]=p=>r("toggle-all"))},null,8,["model-value","indeterminate"])])):x("",!0),e.hideRowIndex!==!0?(u(),y("th",Le,"#")):x("",!0),(u(!0),y(j,null,M(e.tableColumns,(p,w)=>(u(),y("th",{key:w},R(p.title),1))),128)),l.$slots.actions?(u(),y("th",Pe)):x("",!0)])]),E("tbody",null,[(u(!0),y(j,null,M(e.modelValue,(p,w)=>(u(),y("tr",{key:e.rowKey?e.rowKey(p):w},[e.selectable?(u(),y("td",Ie,[O(g,{density:"compact","hide-details":"","model-value":e.selectedKeys?.has(e.rowKey(p)),"onUpdate:modelValue":S=>r("toggle-row",e.rowKey(p))},null,8,["model-value","onUpdate:modelValue"])])):x("",!0),e.hideRowIndex!==!0?(u(),y("td",$e,R(w+1),1)):x("",!0),(u(!0),y(j,null,M(p.cells,(S,s)=>Q(l.$slots,"cell",{key:s,row:p,column:e.tableColumns[s],cell:S,rowIndex:w,colIndex:s},()=>[e.tableColumns[s].rendererType?(u(),y("td",{key:s},[(u(),_(pe(C(Ve)[e.tableColumns[s].rendererType]),{"model-value":o(p,e.tableColumns[s],S.value),width:e.tableColumns[s].width,readonly:!0,"focus-key":0},null,8,["model-value","width"]))])):x("",!0)],!0)),128)),l.$slots.actions?(u(),y("td",Ae,[Q(l.$slots,"actions",{row:p,rowIndex:w},void 0,!0)])):x("",!0)]))),128))])]),_:3})):x("",!0)}}}),De=q(Ke,[["__scopeId","data-v-ed062377"]]),Ee=k({__name:"SelectableTable",props:{tableRows:{},tableColumns:{},allSelected:{type:Boolean}},emits:["update:selected"],setup(e,{emit:t}){const n=e,r=b(()=>Te(n.tableRows)),o=t,a=K(new Set);N(()=>{n.allSelected===!0&&d()});function c(m){return m.id??""}function l(m){a.value.has(m)?a.value.delete(m):a.value.add(m),g()}function d(){a.value.size===n.tableRows.length?a.value.clear():n.tableRows.forEach(m=>a.value.add(c(m))),g()}function g(){o("update:selected",n.tableRows.filter(m=>a.value.has(c(m))))}return(m,p)=>(u(),_(De,{modelValue:r.value,"table-columns":e.tableColumns,selectable:"","selected-keys":a.value,"row-key":c,onToggleRow:l,onToggleAll:d},null,8,["modelValue","table-columns","selected-keys"]))}}),Me={name:"productCode",title:"Κωδικός",type:"productCode",editorType:"text",rendererType:"text",navigable:!0,width:"2vw"},je={name:"colour",title:"Χρώμα",type:"variation",editorType:"autocomplete",rendererType:"text",navigable:!0,width:"2.5vw",list:["WILD","F","GLOW","BL","ΚΦ","ΒΕΡ. ΝΑΠΑ","ΣΑ.ΤΖΙΝ","ΣΑ","ΚΝΛ","ΨΗΦ","OL","X","XK","ΤΑΜΠΑ","ΤΑΜΠΑ.ΨΑΘΑ","ΓΚΡΙ","ΜΝΤ","ΚΙΤ.ΤΖΙΝ","ΚΦ.ΝΑΙΡ","CAM","LIM.ΚΡ","ROSE.ΚΡ","Χ.ΝΑΠΑ","ΤΑΜΠΑ.ΚΡ","OL.ΚΡ","ΚΥΡ.ΝΑΙΡ","Μ","ΓΚΡΙ.ΝΑΙΡ","ΓΚΡΙ.ΚΡ","ΤΜΠ","CIEL.ΚΡ"]},Be={name:"sole",title:"Σόλα",type:"variation",editorType:"autocomplete",rendererType:"text",navigable:!0,width:"2.5vw",list:["anatomic","soft","SOFT","vamos","VAMOS","fiesta","FIESTA","sand","SAND","momo","MOMO","esp"]},Ue={name:"men",title:"Men",type:"flag",rendererType:"checkbox",navigable:!0,width:"1vw"},v="1vw",A=[{name:"shoe:35",title:"35",type:"size",editorType:"number",rendererType:"text",navigable:!0,width:v},{name:"shoe:36",title:"36",type:"size",editorType:"number",rendererType:"text",navigable:!0,width:v},{name:"shoe:37",title:"37",type:"size",editorType:"number",rendererType:"text",navigable:!0,width:v},{name:"shoe:38",title:"38",type:"size",editorType:"number",rendererType:"text",navigable:!0,width:v},{name:"shoe:39",title:"39",type:"size",editorType:"number",rendererType:"text",navigable:!0,width:v},{name:"shoe:40",title:"40",type:"size",editorType:"number",rendererType:"text",navigable:!0,width:v},{name:"shoe:41",title:"41",type:"size",editorType:"number",rendererType:"text",navigable:!0,width:v},{name:"shoe:42",title:"42",type:"size",editorType:"number",rendererType:"text",navigable:!0,width:v},{name:"shoe:43",title:"43",type:"size",editorType:"number",rendererType:"text",navigable:!0,width:v},{name:"shoe:44",title:"44",type:"size",editorType:"number",rendererType:"text",navigable:!0,width:v},{name:"shoe:45",title:"45",type:"size",editorType:"number",rendererType:"text",navigable:!0,width:v},{name:"shoe:46",title:"46",type:"size",editorType:"number",rendererType:"text",navigable:!0,width:v},{name:"shoe:47",title:"47",type:"size",editorType:"number",rendererType:"text",navigable:!0,width:v}],P=[{order:0,...Me},{order:1,...je},{order:2,...Be},{order:3,...Ue},...A.map((e,t)=>({order:t+4,...e})),{order:A.length+4,title:"Τεμάχια",name:"calculated:totalQty",type:"calculated",rendererType:"text",width:"2vw",calculate:re},{order:A.length+5,title:"Τιμή",name:"variationPrice",type:"price",editorType:"price",rendererType:"price",navigable:!0,width:"2.5vw"},{order:A.length+6,title:"Σύνολο",name:"calculated:totalPrice",type:"calculated",rendererType:"price",width:"3vw",calculate:Fe}].sort((e,t)=>e.order-t.order);function re(e){let t=0;return P.forEach((n,r)=>{n.type==="size"&&(t+=Number(e.cells[r].value)||0)}),t.toString()}function Fe(e){const t=Number(re(e))||0,n=P.findIndex(o=>o.name==="variationPrice");if(n===-1)return"";const r=Number(e.cells[n].value)||0;return(t*r).toString()}function qe(e){const t=e.filter(s=>s.type==="variation"),n=e.filter(s=>s.type==="flag"),r=e.filter(s=>s.type==="size"),o=e.find(s=>s.type==="price"),a=e.find(s=>s.type==="productCode");function c(s){return s.map(i=>({id:i.derivedSku,cells:e.map(f=>r.includes(f)?Ne(i.sizing,f.name):f===o?oe(i.unitPrice):f===a?i.productCode:l(i.variationSnapshot,f))}))}function l(s,i){return i.type==="flag"?s.flags?.[i.name]?"true":"":s.attributes?.[i.name]||""}function d(s){return s.map(i=>{const f={attributes:g(i),flags:m(i)},I=p(i),$=w(i),D=S(i);return{unitPrice:$,productCode:I,variationSnapshot:f,sizing:D,derivedSku:H(I,f)}})}function g(s){return Object.fromEntries(t.map(i=>[i.name,s.cells[i.order]]))}function m(s){return Object.fromEntries(n.filter(i=>!!s.cells[i.order]).map(i=>[i.name,!0]))}function p(s){return s.cells[e.indexOf(a)]?s.cells[e.indexOf(a)]:""}function w(s){return s.cells[e.indexOf(o)]?J(s.cells[e.indexOf(o)]):0}function S(s){return Object.fromEntries(r.map(i=>[i.name,J(s.cells[i.order])]))}return{vmToRows:c,rowsToVm:d}}function Ne(e,t){const n=He(e,t);return oe(n)}function He(e,t){const n=e[t];return n||0}function J(e){return e&&e!==""?Number(e):0}function oe(e){return e>0?e.toString():""}function ae(e){const t=e.map(Ge);return We(t)}function Ge(e){const t=e.sku.variationSnapshot.attributes??{},{size:n,...r}=t;return{name:e.name,unitPrice:e.unitPrice,productCode:e.productCode,derivedSku:H(e.productCode,{attributes:r,flags:e.sku.variationSnapshot.flags}),variationSnapshot:{attributes:r,flags:e.sku.variationSnapshot.flags},sizing:Ye(n,e.quantity)}}function We(e){const t=new Map;for(const n of e){const r=n.derivedSku,o=t.get(r);if(o)for(const[a,c]of Object.entries(n.sizing))o.sizing[a]=(o.sizing[a]||0)+c;else t.set(r,{...n,sizing:{...n.sizing}})}return[...t.values()]}function Ye(e,t){return{[`shoe:${e}`]:t}}function Qe(e,t){const n=Je(e);ie(n,`${t}-printlist.csv`)}function Xe(e,t,n){const r=Ze(e,t);ie(r,`${n}-list.csv`)}function Ze(e,t){if(!e.length)return"";const n=["MODEL",...t.filter(a=>a.type==="size").map(a=>a.title),"PAIRS","PRICE","TOTAL PRICE"],r=t.filter(a=>a.type==="size"),o=ae(e);return se(n,o.map(a=>tt(a,r)))}function Je(e){return e.length?se(["MODEL","Size"],e.flatMap(n=>et(n))):""}function se(e,t){return[e.join(", "),...t].join(`
\r`)}function et(e){const t=nt(e),n=e.sku.size,r=`${t}, ${n}`;return Array(e.quantity).fill(r)}function tt(e,t){const n=`${e.productCode}${rt(e.variationSnapshot).join(" ")}`,r=t.map(l=>l.name in e.sizing?e.sizing[l.name].toString():"0"),o=Object.values(e.sizing).reduce((l,d)=>l+d,0),a=e.unitPrice,c=o*a;return[n,...r,o,Z(a),Z(c)].join(", ")}function nt(e){return`${e.sku.productCode}${e.sku.getSnapshotValues(["size"]).join(" ")}`}function ie(e,t="export.csv"){const n=new Blob([e],{type:"text/csv;charset=utf-8;"}),r=URL.createObjectURL(n),o=document.createElement("a");o.href=r,o.setAttribute("download",t),document.body.appendChild(o),o.click(),document.body.removeChild(o),URL.revokeObjectURL(r)}function rt(e){const t=ot(e.attributes),n=at(e.flags);return[...t,...n]}function ot(e){return e?Object.entries(e).map(([,t])=>t):[]}function at(e){return e?Object.entries(e).map(([t])=>t):[]}function St(e){return{partnerId:e.partnerId,vatRate:e.vatRate,dueDate:e.dueDate||void 0,notes:e.notes,depositAmount:e.depositAmount,discountAmount:e.discountAmount,items:le(e.items)}}function le(e){const t=e.flatMap(n=>st(n));return it(t).sort((n,r)=>n.derivedSku.localeCompare(r.derivedSku))}function st(e,t){const n=lt(e.sizing),r=ct(e.variationSnapshot);return n.map(([o,a])=>{const c={attributes:{...r.attributes??{},size:o},flags:r.flags};return{name:e.name,unitPrice:e.unitPrice,productCode:e.productCode,quantity:a,variationSnapshot:c,derivedSku:H(e.productCode,c)}})}function it(e){const t=new Map;for(const n of e){const r=n.derivedSku,o=t.get(r);o?o.quantity+=n.quantity:t.set(r,{...n})}return[...t.values()]}function lt(e){return Object.entries(e).filter(([t,n])=>n>0).map(([t,n])=>[t.split(":")[1],n])}function ct(e,t){const n={...ut(e.attributes)??{}},r={...e.flags??{}};return{...Object.keys(n).length?{attributes:n}:{},...Object.keys(r).length?{flags:r}:{}}}function ut(e){if(!e)return;const t=Object.fromEntries(Object.entries(e).filter(([n,r])=>r!==""));return Object.keys(t).length>0?t:void 0}const xt=k({__name:"SelectLineItemsModal",props:{modelValue:{type:Boolean},filename:{},items:{},type:{}},emits:["update:model-value"],setup(e,{emit:t}){const{tCap:n}=U(),r=e,o=t,a=K([]),{vmToRows:c,rowsToVm:l}=qe(P),d=b(()=>{const i=ae(r.items);return c(i)}),g=b(()=>{if(r.type==="labels")return n("order.labelCsvTitle");if(r.type==="lineItems")return n("order.listCsvTitle")}),m=b(()=>{if(r.type==="labels")return i=>Qe(i,r.filename);if(r.type==="lineItems")return i=>Xe(i,P,r.filename);throw new Error("not a valid type")});function p(){const i=w();m.value(i),S()}function w(){const i=l(a.value);return le(i).map(ne.toModel)}function S(){o("update:model-value",!1),a.value=[]}function s(i){i||S()}return(i,f)=>{const I=T("v-card-text"),$=T("v-btn"),D=T("v-card-actions"),ce=T("v-card"),ue=T("v-dialog");return u(),_(ue,{"model-value":e.modelValue,"onUpdate:modelValue":s,"max-width":"1800"},{default:z(()=>[O(ce,{title:g.value},{default:z(()=>[O(I,null,{default:z(()=>[O(Ee,{"table-rows":d.value,"table-columns":C(P),"all-selected":!0,selected:a.value,"onUpdate:selected":f[0]||(f[0]=W=>a.value=W)},null,8,["table-rows","table-columns","selected"])]),_:1}),O(D,null,{default:z(()=>[O($,{variant:"tonal",color:"indigo",text:C(n)("common.exportCsv"),onClick:p},null,8,["text"]),O($,{text:C(n)("common.cancel"),color:"red",onClick:f[1]||(f[1]=W=>o("update:model-value",!1))},null,8,["text"])]),_:1})]),_:1},8,["title"])]),_:1},8,["model-value"])}}});function dt(e){const t=L();return b(()=>t.orders.find(n=>n.id===e))}function mt(e){const t=L();return b(()=>t.orders.filter(n=>n.partnerId===e))}class pt{static async getNext(t){const n=new Date().getFullYear()%100,r=await G.load(),o=await fe.getById(t);if(!o)throw new Error(`Partner with id:${t} doesn't exist`);const a=r.filter(l=>l.partnerId===t);if(a.length===0)return X.create(n,o.clientNumber,1);const c=a.map(l=>l.sequence).filter(l=>l.year===n).sort((l,d)=>l.format().localeCompare(d.format())).at(-1);if(!c)throw new Error("error with find the sequence");return X.create(n,o.clientNumber,c.value+1)}}class ft{constructor(t=L()){this._orderStore=t}async handle(t){const n=t.items.map(ne.toModel),r=await pt.getNext(t.partnerId),o=ye.createIncomingOrder(t.partnerId,r,n,t.vatRate,t.dueDate,t.notes,t.discountAmount,t.depositAmount);await G.add(o),this._orderStore.add(B.toDTO(o))}}class yt{constructor(t=L()){this._orderStore=t}async handle(t){await G.remove(t.id),this._orderStore.remove(t.id)}}function Ot(){const e=L(),{allOrders:t}=he(e);return{allOrders:b(()=>t.value.map(B.toModel)),totalsPerPartner:b(()=>e.totalsPerPartner),globalTotals:b(()=>e.globalTotals),creditOrders:e.creditOrders,debitOrders:e.debitOrders,totalCredited:e.totalCredited,totalDebited:e.totalDebited,balance:e.balance,getOrderById:dt,getOrdersForPartner:mt,createCreditOrderCommmandHandler:new ft(e),deleteOrderCommmandHandler:new yt(e)}}export{De as B,V as N,Se as T,wt as _,vt as a,xt as b,ke as c,Ct as d,Te as e,qe as f,we as g,gt as h,ae as m,St as o,Ve as r,P as s,Tt as t,Ot as u};
