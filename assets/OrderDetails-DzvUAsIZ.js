import{_ as $}from"./ConfirmDeleteModal.vue_vue_type_script_setup_true_lang-BdXbt4UY.js";import{u as A,a as N,_ as R,d as V,B,e as E,s as I,f as j}from"./useVariationTableMapper-DSMkvWi0.js";import{d as C,g as O,C as S,c as g,e as n,l as i,q as l,B as u,z as a,x as y,y as f,u as r,I as T,F as P,o as _,_ as H,m as w,a3 as M,a5 as z,G as q,H as F}from"./index-DWX8wXUJ.js";import{g as G}from"./usePartnerDetails-wLJYHqpa.js";import{n as K}from"./priceUtils-1yxS_Q4Z.js";function L(e){return e.toLocaleDateString()}function D(e){return K(e)}const U={class:"mr-2"},J={key:0,class:"text-subtitle-1 text-grey-darken-1 order-details-line"},Q={key:1,class:"text-subtitle-1 text-grey-darken-1 order-details-line"},W={class:"text-subtitle-1 text-grey-darken-1 font-weight-bold order-details-line"},X={class:"formatted-notes"},Y={class:"text-h5 font-weight-bold"},Z={key:0},ee={key:0},te=C({__name:"OrderDetailsHeader",props:{order:{}},setup(e){const{tCap:t}=O(),s=P(),{deleteOrderCommmandHandler:c}=A(),o=e,m=S(()=>G(o.order.partnerId));function d(){return`#${o.order.orderNumber}`}function p(){s.back(),c.handle({id:o.order.id})}return(k,h)=>{const v=i("v-col"),x=i("v-row"),b=i("v-btn");return _(),g(T,null,[n(x,{align:"start",justify:"space-between",dense:""},{default:l(()=>[n(v,{cols:"5",class:"d-flex",justify:"start"},{default:l(()=>[u("h1",U,a(d()),1),n(N,{status:e.order.status,class:"ml-2 mt-2"},null,8,["status"]),n(R,{type:e.order.type,class:"ml-2 mt-2"},null,8,["type"])]),_:1}),n(v,{cols:"4",class:"d-flex flex-row justify-end"}),n(v,{cols:"1",class:"d-flex flex-row justify-end"},{default:l(()=>[n($,{name:d(),"action-fn":()=>p(),mini:""},null,8,["name","action-fn"])]),_:1})]),_:1}),n(x,{align:"start",justify:"space-between",dense:""},{default:l(()=>[n(v,{cols:"3",class:"text-md-left"},{default:l(()=>[m.value?(_(),g("div",J,[u("strong",null,a(r(t)("partner.customer")),1),h[0]||(h[0]=f(": ",-1)),n(b,{variant:"text",to:`/partner/${m.value.id}`},{default:l(()=>[f(a(m.value.businessName),1)]),_:1},8,["to"])])):y("",!0),e.order.dueDate?(_(),g("div",Q,[u("strong",null,a(r(t)("order.dueDate")),1),f(": "+a(r(L)(e.order.dueDate)),1)])):y("",!0),u("div",W,a(r(t)("order.notes"))+": ",1),u("span",X,a(e.order.notes),1)]),_:1}),n(v,{cols:"4",md:"5",class:"text-md-right"},{default:l(()=>[u("span",null,a(r(t)("order.total")),1),u("div",Y,a(r(D)(e.order.totalAmount)),1),u("div",null,[f(a(r(t)("order.orderSum"))+" ",1),u("strong",null,a(r(D)(e.order.subtotal)),1),f(" · "+a(r(t)("order.vatRate"))+" ",1),u("strong",null,a(r(D)(e.order.taxAmount)),1),e.order.discountAmount>0?(_(),g("span",Z,[f(" · "+a(r(t)("order.discount"))+" ",1),u("strong",null,a(r(D)(e.order.discountAmount)),1)])):y("",!0)]),e.order.depositAmount>0?(_(),g("div",ee,[f(a(r(t)("order.deposit"))+" ",1),u("strong",null,a(r(D)(e.order.discountAmount)),1),f(" · "+a(r(t)("order.remainingAmount"))+" ",1),u("strong",null,a(r(D)(e.order.remainingAmount)),1)])):y("",!0)]),_:1})]),_:1})],64)}}}),ne=H(te,[["__scopeId","data-v-9ebd70c7"]]),oe=C({__name:"DisplayTable",props:{tableRows:{},tableColumns:{},hideRowIndex:{type:Boolean}},setup(e){const t=e,s=S(()=>V(t.tableRows));return(c,o)=>(_(),w(B,{modelValue:s.value,"table-columns":e.tableColumns,"hide-row-index":e.hideRowIndex},null,8,["modelValue","table-columns","hide-row-index"]))}});function re(e){const t=e.map(ae);return se(t)}function ae(e){const t=e.sku.variationSnapshot.attributes??{},{size:s,...c}=t;return{name:e.name,unitPrice:e.unitPrice,productCode:e.productCode,derivedSku:M(e.productCode,{attributes:c,flags:e.sku.variationSnapshot.flags}),variationSnapshot:{attributes:c,flags:e.sku.variationSnapshot.flags},sizing:le(s,e.quantity)}}function se(e){const t=new Map;for(const s of e){const c=s.derivedSku,o=t.get(c);if(o)for(const[m,d]of Object.entries(s.sizing))o.sizing[m]=(o.sizing[m]||0)+d;else t.set(c,{...s,sizing:{...s.sizing}})}return[...t.values()]}function le(e,t){return{[`shoe:${e}`]:t}}const de=C({__name:"OrderDetailsLineItems",props:{order:{}},setup(e){const{tCap:t}=O(),{vmToRows:s}=E(I),c=e,o=S(()=>{const m=re([...c.order.items]);return s(m)});return(m,d)=>{const p=i("v-chip"),k=i("v-list-item"),h=i("v-card-title"),v=i("v-card-text"),x=i("v-card");return _(),w(x,null,{default:l(()=>[n(h,null,{default:l(()=>[n(k,null,{title:l(()=>[u("h3",null,a(r(t)("order.items",2)),1)]),append:l(()=>[n(p,{size:"small"},{default:l(()=>[f(a(e.order.items.length),1)]),_:1})]),_:1})]),_:1}),n(v,null,{default:l(()=>[n(oe,{tableRows:o.value,"table-columns":r(I)},null,8,["tableRows","table-columns"])]),_:1})]),_:1})}}});function ce(e){const{tCap:t}=O(),s=[{name:t("order.createdDate"),getDate:o=>o.createdDate},{name:t("order.approvedDate"),getDate:o=>o.approvedDate},{name:t("order.shippedDate"),getDate:o=>o.shippedDate},{name:t("order.completedDate"),getDate:o=>o.completedDate}],c={name:t("order.cancelledDate"),getDate:o=>o.cancelledDate,isCancelled:!0};return{timelineItems:S(()=>ie(e.value,s,c))}}function ie(e,t,s){const c=[...t];e.status===z.Cancelled&&c.push(s);const o=c.map(d=>({name:d.name,date:d.getDate(e)})),m=o.map(d=>d.date).findLastIndex(d=>d!==void 0);return o.map((d,p)=>e.status===z.Cancelled&&d.name==="Cancelled"?{...d,colour:"red"}:d.date?{...d,colour:p===m?"indigo":"cyan"}:{...d,colour:"grey"})}const ue={class:"d-flex"},me={key:0,class:"me-4"},_e=C({__name:"OrderDetailsTimeline",props:{order:{}},setup(e){const{tCap:t}=O(),s=e,{timelineItems:c}=ce(q(s,"order"));return(o,m)=>{const d=i("v-card-title"),p=i("v-divider"),k=i("v-timeline-item"),h=i("v-timeline"),v=i("v-card-text"),x=i("v-card");return _(),w(x,null,{default:l(()=>[n(d,null,{default:l(()=>[f(a(r(t)("common.timeline")),1)]),_:1}),n(p),n(v,null,{default:l(()=>[n(h,{align:"start",side:"end",direction:"horizontal"},{default:l(()=>[(_(!0),g(T,null,F(r(c),b=>(_(),w(k,{"dot-color":b.colour,size:"small"},{opposite:l(()=>[u("div",null,a(b.name),1)]),default:l(()=>[u("div",ue,[b.date?(_(),g("strong",me,a(r(L)(b.date)),1)):y("",!0)])]),_:2},1032,["dot-color"]))),256))]),_:1})]),_:1})]),_:1})}}}),xe=C({__name:"OrderDetails",props:{id:{}},setup(e){const t=e,{model:s}=j(t.id);return(c,o)=>{const m=i("v-col"),d=i("v-row"),p=i("v-container");return r(s)?(_(),w(p,{key:0},{default:l(()=>[n(ne,{order:r(s)},null,8,["order"]),n(d,{class:"mt-6",align:"start"},{default:l(()=>[n(m,{cols:"12"},{default:l(()=>[n(de,{order:r(s)},null,8,["order"])]),_:1}),n(m,{cols:"12",md:"12",xl:"12"},{default:l(()=>[n(_e,{order:r(s)},null,8,["order"])]),_:1})]),_:1})]),_:1})):y("",!0)}}});export{xe as default};
