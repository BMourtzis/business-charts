import{g as ee,n as te}from"./priceUtils-1yxS_Q4Z.js";import{a9 as U,ab as ne,ac as F,Z as oe,C as D,d as b,f as ae,g as x,j as re,k as se,m as f,l as r,u as e,p as T,q as a,e as o,x as me,y as g,z as y,A as le,o as h,G as ie,F as ce,B as $}from"./index-BxCWqn6m.js";import{a as de,c as I,b as R,u as ue,g as pe,d as _e,e as ve,f as Me,h as ye}from"./useMoneyMovementDetails-CbygyY-0.js";import{u as fe}from"./usePartners-DE75Z4U3.js";import{_ as he}from"./ConfirmDeleteModal.vue_vue_type_script_setup_true_lang-D9jTtcsG.js";import{_ as ge}from"./PartnerBtn.vue_vue_type_script_setup_true_lang-CPPsYL-j.js";import{g as be}from"./usePartnerDetails-BxyTqyBt.js";class xe{constructor(n=U()){this._movementStore=n}async handle(n){const m=await de.getNext(n.partnerId),d=this.createMovement(n,m);await ne.add(d),this._movementStore.add(F.toDTO(d))}createMovement(n,m){switch(n.reason){case I.CustomerPayment:return R.customerPayment(m,n.partnerId,n.amount,n.method);case I.SupplierPayment:return R.supplierPayment(m,n.partnerId,n.amount,n.method);case I.CustomerRefund:return R.customerRefund(m,n.partnerId,n.amount,n.method);default:throw new Error("Other reasons are not implemented yet")}}}function H(){const t=U(),{allMovements:n}=oe(t);return{allMoneyMovements:D(()=>n.value.map(F.toModel)),createMoneyMovementCommandHandler:new xe(t)}}const Ve=b({__name:"AddMovementModal",setup(t){const{partners:n,partnersToItemProps:m}=fe(),{createMoneyMovementCommandHandler:d}=H(),{paymentMethodTypes:p,movementReasonTypes:M}=ue(),{required:v}=ae(),{tCap:l}=x(),u=re({amount:null,partnerId:null,method:null,reason:null}),{dialog:i,formRef:B,validForm:V,loading:w,errorMessage:N,close:L,reset:P,submit:j}=se(u);async function z(){await j(async _=>{!_.amount||!_.partnerId||!_.method||!_.reason||(await d.handle({partnerId:_.partnerId,amount:Number(_.amount),method:_.method,reason:_.reason}),P())})}return(_,c)=>{const C=r("v-btn"),A=r("v-text-field"),k=r("v-col"),G=r("v-autocomplete"),O=r("v-icon"),S=r("v-select"),q=r("v-row"),E=r("v-alert"),Z=r("v-container"),J=r("v-form"),K=r("v-card-text"),Q=r("v-spacer"),W=r("v-card-actions"),X=r("v-card"),Y=r("v-dialog");return h(),f(Y,{modelValue:e(i),"onUpdate:modelValue":c[5]||(c[5]=s=>T(i)?i.value=s:null),"max-width":"800"},{activator:a(({props:s})=>[o(C,le(s,{color:"indigo",text:e(l)("moneyMovement.addMoneyMovement"),"prepend-icon":"mdi-plus",variant:"flat"}),null,16,["text"])]),default:a(()=>[o(X,{title:e(l)("moneyMovement.addMoneyMovement")},{default:a(()=>[o(K,null,{default:a(()=>[o(J,{ref_key:"formRef",ref:B,modelValue:e(V),"onUpdate:modelValue":c[4]||(c[4]=s=>T(V)?V.value=s:null)},{default:a(()=>[o(Z,{fluid:""},{default:a(()=>[o(q,{dense:""},{default:a(()=>[o(k,{cols:"6"},{default:a(()=>[o(A,{modelValue:u.amount,"onUpdate:modelValue":c[0]||(c[0]=s=>u.amount=s),type:"number",label:e(l)("moneyMovement.amount"),rules:[e(v)],min:0,step:"0.01",inputmode:"decimal",suffix:e(ee)()},null,8,["modelValue","label","rules","suffix"])]),_:1}),o(k,{cols:"6"},{default:a(()=>[o(G,{modelValue:u.partnerId,"onUpdate:modelValue":c[1]||(c[1]=s=>u.partnerId=s),"item-props":e(m),label:e(l)("partner.partner"),items:e(n),rules:[e(v)]},null,8,["modelValue","item-props","label","items","rules"])]),_:1}),o(k,{cols:"6"},{default:a(()=>[o(S,{modelValue:u.method,"onUpdate:modelValue":c[2]||(c[2]=s=>u.method=s),label:e(l)("moneyMovement.method"),items:e(p),rules:[e(v)],"item-title":"title","item-value":"value","item-props":s=>({prependIcon:s.icon})},{selection:a(({item:s})=>[o(O,{class:"mr-2"},{default:a(()=>[g(y(s.raw.icon),1)]),_:2},1024),g(" "+y(s.raw.title),1)]),_:1},8,["modelValue","label","items","rules","item-props"])]),_:1}),o(k,{cols:"6"},{default:a(()=>[o(S,{modelValue:u.reason,"onUpdate:modelValue":c[3]||(c[3]=s=>u.reason=s),label:e(l)("moneyMovement.reason"),items:e(M),rules:[e(v)],"item-title":"title","item-value":"value"},null,8,["modelValue","label","items","rules"])]),_:1})]),_:1}),e(N)?(h(),f(E,{key:0,type:"error",variant:"tonal",density:"compact",class:"mt-2"},{default:a(()=>[g(y(e(N)),1)]),_:1})):me("",!0)]),_:1})]),_:1},8,["modelValue"])]),_:1}),o(W,null,{default:a(()=>[o(C,{variant:"tonal",color:"warning",text:e(l)("common.clear"),onClick:e(P)},null,8,["text","onClick"]),o(Q),o(C,{variant:"tonal",color:"indigo",text:e(l)("common.save"),loading:e(w),disabled:!e(V)||e(w),onClick:z},null,8,["text","loading","disabled"]),o(C,{text:e(l)("common.cancel"),color:"red",disabled:e(w),onClick:e(L)},null,8,["text","disabled","onClick"])]),_:1})]),_:1},8,["title"])]),_:1},8,["modelValue"])}}}),Ce=b({__name:"PaymentMethodChip",props:{method:{}},setup(t){const{tCap:n}=x();return(m,d)=>{const p=r("v-chip");return h(),f(p,{variant:"outlined",color:"indigo","prepend-icon":e(pe)(t.method)},{default:a(()=>[g(y(e(_e)(t.method,e(n))),1)]),_:1},8,["prepend-icon"])}}}),ke=b({__name:"MovementReasonChip",props:{reason:{},direction:{}},setup(t){const{tCap:n}=x();return(m,d)=>{const p=r("v-chip");return h(),f(p,{variant:"outlined",color:e(Me)(t.direction),"prepend-icon":e(ve)(t.direction)},{default:a(()=>[g(y(e(ye)(t.reason,e(n))),1)]),_:1},8,["color","prepend-icon"])}}});function we(t){return{id:t.id,movementNumber:Ie(t.movementNumber),partner:be(t.partnerId),createdDate:Re(t.createdDate),amount:te(t.amount),method:t.method,direction:t.direction,reason:t.reason}}function Ie(t){return`#${t}`}function Re(t){return t?t.toLocaleDateString():"-"}function De(t){return[{title:t("moneyMovement.number"),key:"movementNumber",align:"start"},{title:t("partner.businessName"),key:"partner",align:"start"},{title:t("moneyMovement.createdDate"),key:"createdDate",align:"start"},{title:t("moneyMovement.reason"),key:"reason",align:"start"},{title:t("moneyMovement.method"),key:"method",align:"start"},{title:t("moneyMovement.amount"),key:"amount",align:"start"}]}function Ne(t){const{tCap:n}=x(),m=D(()=>(t.value??[]).map(M=>we(M))),d=D(()=>De(n));return{data:m,headers:d}}const Pe=b({__name:"MoneyMovementList",props:{moneyMovements:{}},setup(t){const n=ce(),m=t,{data:d,headers:p}=Ne(ie(m,"moneyMovements"));function M(v,l){n.push(`/moneyMovements/${l.item.id}`)}return(v,l)=>{const u=r("v-data-table");return h(),f(u,{headers:e(p),items:e(d),class:"text-start","hide-default-footer":"",density:"comfortable","items-per-page":-1,hover:"","onClick:row":M},{"item.partner":a(({item:i})=>[o(ge,{partner:i.partner},null,8,["partner"])]),"item.method":a(({item:i})=>[o(Ce,{method:i.method},null,8,["method"])]),"item.reason":a(({item:i})=>[o(ke,{reason:i.reason,direction:i.direction},null,8,["reason","direction"])]),"item.actions":a(({item:i})=>[o(he,{name:i.movementNumber,"action-fn":()=>"",mini:!0},null,8,["name"])]),_:2},1032,["headers","items"])}}}),Se={class:"d-flex justify-space-between align-center mb-4"},Te={class:"text-h6"},ze=b({__name:"MoneyMovementView",setup(t){const{tCap:n}=x(),{allMoneyMovements:m}=H();return(d,p)=>{const M=r("v-card"),v=r("v-container");return h(),f(v,{class:"py-6"},{default:a(()=>[o(M,{class:"pa-4"},{default:a(()=>[$("div",Se,[$("h2",Te,y(e(n)("moneyMovement.moneyMovement",2)),1),o(Ve)]),o(Pe,{"money-movements":e(m)},null,8,["money-movements"])]),_:1})]),_:1})}}});export{ze as default};
