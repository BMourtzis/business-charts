import{g as ee,n as te}from"./priceUtils-1yxS_Q4Z.js";import{a9 as U,ab as oe,ac as F,Z as ne,C as I,d as N,f as ae,g as R,j as re,k as se,m as h,l as s,u as e,p as S,q as a,e as o,x as me,y as k,z as g,A as le,o as x,G as ie,F as ue,B as $}from"./index-GJmNcSpu.js";import{b as w,u as ce,_ as de,a as pe}from"./MovementReasonChip.vue_vue_type_script_setup_true_lang-BsDfde0g.js";import{M as _e,a as C}from"./movementNumberService-DVkmYW5S.js";import{u as ve}from"./usePartners-CFSt2nES.js";import{_ as fe}from"./ConfirmDeleteModal.vue_vue_type_script_setup_true_lang-DMZbPiBp.js";import{_ as ye}from"./PartnerBtn.vue_vue_type_script_setup_true_lang-DevVEvKf.js";import{g as Me}from"./usePartnerDetails-BGxv90qD.js";class be{constructor(n=U()){this._movementStore=n}async handle(n){const m=await _e.getNext(n.partnerId),d=this.createMovement(n,m);await oe.add(d),this._movementStore.add(F.toDTO(d))}createMovement(n,m){switch(n.reason){case w.CustomerPayment:return C.customerPayment(m,n.partnerId,n.amount,n.method);case w.SupplierPayment:return C.supplierPayment(m,n.partnerId,n.amount,n.method);case w.CustomerRefund:return C.customerRefund(m,n.partnerId,n.amount,n.method);default:throw new Error("Other reasons are not implemented yet")}}}function H(){const t=U(),{allMovements:n}=ne(t);return{allMoneyMovements:I(()=>n.value.map(F.toModel)),createMoneyMovementCommandHandler:new be(t)}}const ge=N({__name:"AddMovementModal",setup(t){const{partners:n,partnersToItemProps:m}=ve(),{createMoneyMovementCommandHandler:d}=H(),{paymentMethodTypes:f,movementReasonTypes:v}=ce(),{required:_}=ae(),{tCap:l}=R(),c=re({amount:null,partnerId:null,method:null,reason:null}),{dialog:i,formRef:B,validForm:y,loading:V,errorMessage:D,close:L,reset:T,submit:j}=se(c);async function z(){await j(async p=>{!p.amount||!p.partnerId||!p.method||!p.reason||(await d.handle({partnerId:p.partnerId,amount:Number(p.amount),method:p.method,reason:p.reason}),T())})}return(p,u)=>{const M=s("v-btn"),A=s("v-text-field"),b=s("v-col"),G=s("v-autocomplete"),O=s("v-icon"),P=s("v-select"),q=s("v-row"),E=s("v-alert"),Z=s("v-container"),J=s("v-form"),K=s("v-card-text"),Q=s("v-spacer"),W=s("v-card-actions"),X=s("v-card"),Y=s("v-dialog");return x(),h(Y,{modelValue:e(i),"onUpdate:modelValue":u[5]||(u[5]=r=>S(i)?i.value=r:null),"max-width":"800"},{activator:a(({props:r})=>[o(M,le(r,{color:"indigo",text:e(l)("moneyMovement.addMoneyMovement"),"prepend-icon":"mdi-plus",variant:"flat"}),null,16,["text"])]),default:a(()=>[o(X,{title:e(l)("moneyMovement.addMoneyMovement")},{default:a(()=>[o(K,null,{default:a(()=>[o(J,{ref_key:"formRef",ref:B,modelValue:e(y),"onUpdate:modelValue":u[4]||(u[4]=r=>S(y)?y.value=r:null)},{default:a(()=>[o(Z,{fluid:""},{default:a(()=>[o(q,{dense:""},{default:a(()=>[o(b,{cols:"6"},{default:a(()=>[o(A,{modelValue:c.amount,"onUpdate:modelValue":u[0]||(u[0]=r=>c.amount=r),type:"number",label:e(l)("moneyMovement.amount"),rules:[e(_)],min:0,step:"0.01",inputmode:"decimal",suffix:e(ee)()},null,8,["modelValue","label","rules","suffix"])]),_:1}),o(b,{cols:"6"},{default:a(()=>[o(G,{modelValue:c.partnerId,"onUpdate:modelValue":u[1]||(u[1]=r=>c.partnerId=r),"item-props":e(m),label:e(l)("partner.partner"),items:e(n),rules:[e(_)]},null,8,["modelValue","item-props","label","items","rules"])]),_:1}),o(b,{cols:"6"},{default:a(()=>[o(P,{modelValue:c.method,"onUpdate:modelValue":u[2]||(u[2]=r=>c.method=r),label:e(l)("moneyMovement.method"),items:e(f),rules:[e(_)],"item-title":"title","item-value":"value","item-props":r=>({prependIcon:r.icon})},{selection:a(({item:r})=>[o(O,{class:"mr-2"},{default:a(()=>[k(g(r.raw.icon),1)]),_:2},1024),k(" "+g(r.raw.title),1)]),_:1},8,["modelValue","label","items","rules","item-props"])]),_:1}),o(b,{cols:"6"},{default:a(()=>[o(P,{modelValue:c.reason,"onUpdate:modelValue":u[3]||(u[3]=r=>c.reason=r),label:e(l)("moneyMovement.reason"),items:e(v),rules:[e(_)],"item-title":"title","item-value":"value"},null,8,["modelValue","label","items","rules"])]),_:1})]),_:1}),e(D)?(x(),h(E,{key:0,type:"error",variant:"tonal",density:"compact",class:"mt-2"},{default:a(()=>[k(g(e(D)),1)]),_:1})):me("",!0)]),_:1})]),_:1},8,["modelValue"])]),_:1}),o(W,null,{default:a(()=>[o(M,{variant:"tonal",color:"warning",text:e(l)("common.clear"),onClick:e(T)},null,8,["text","onClick"]),o(Q),o(M,{variant:"tonal",color:"indigo",text:e(l)("common.save"),loading:e(V),disabled:!e(y)||e(V),onClick:z},null,8,["text","loading","disabled"]),o(M,{text:e(l)("common.cancel"),color:"red",disabled:e(V),onClick:e(L)},null,8,["text","disabled","onClick"])]),_:1})]),_:1},8,["title"])]),_:1},8,["modelValue"])}}});function he(t){return{id:t.id,movementNumber:xe(t.movementNumber),partner:Me(t.partnerId),createdDate:Ve(t.createdDate),amount:te(t.amount),method:t.method,direction:t.direction,reason:t.reason}}function xe(t){return`#${t}`}function Ve(t){return t?t.toLocaleDateString():"-"}function ke(t){return[{title:t("moneyMovement.number"),key:"movementNumber",align:"start"},{title:t("partner.businessName"),key:"partner",align:"start"},{title:t("moneyMovement.createdDate"),key:"createdDate",align:"start"},{title:t("moneyMovement.reason"),key:"reason",align:"start"},{title:t("moneyMovement.method"),key:"method",align:"start"},{title:t("moneyMovement.amount"),key:"amount",align:"start"}]}function we(t){const{tCap:n}=R(),m=I(()=>(t.value??[]).map(v=>he(v))),d=I(()=>ke(n));return{data:m,headers:d}}const Ce=N({__name:"MoneyMovementList",props:{moneyMovements:{}},setup(t){const n=ue(),m=t,{data:d,headers:f}=we(ie(m,"moneyMovements"));function v(_,l){n.push(`/moneyMovements/${l.item.id}`)}return(_,l)=>{const c=s("v-data-table");return x(),h(c,{headers:e(f),items:e(d),class:"text-start","hide-default-footer":"",density:"comfortable","items-per-page":-1,hover:"","onClick:row":v},{"item.partner":a(({item:i})=>[o(ye,{partner:i.partner},null,8,["partner"])]),"item.method":a(({item:i})=>[o(pe,{method:i.method},null,8,["method"])]),"item.reason":a(({item:i})=>[o(de,{reason:i.reason,direction:i.direction},null,8,["reason","direction"])]),"item.actions":a(({item:i})=>[o(fe,{name:i.movementNumber,"action-fn":()=>"",mini:!0},null,8,["name"])]),_:2},1032,["headers","items"])}}}),Ie={class:"d-flex justify-space-between align-center mb-4"},Ne={class:"text-h6"},He=N({__name:"MoneyMovementView",setup(t){const{tCap:n}=R(),{allMoneyMovements:m}=H();return(d,f)=>{const v=s("v-card"),_=s("v-container");return x(),h(_,{class:"py-6"},{default:a(()=>[o(v,{class:"pa-4"},{default:a(()=>[$("div",Ie,[$("h2",Ne,g(e(n)("moneyMovement.moneyMovement",2)),1),o(ge)]),o(Ce,{"money-movements":e(m)},null,8,["money-movements"])]),_:1})]),_:1})}}});export{He as default};
