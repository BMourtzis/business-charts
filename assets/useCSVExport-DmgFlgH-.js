import{a7 as L,C as v,ac as E,a4 as H,$ as y,d as k,g as B,m as V,l as T,u as S,q as z,y as X,z as R,o as d,c as f,a0 as M,_ as F,r as I,a as q,n as Z,w as le,G as ce,x,B as K,e as O,H as D,I as j,a1 as G,a3 as ue,ae as U,af as J,a9 as N,ag as de,ah as W,ai as me,Z as pe}from"./index-CeMrVeL6.js";import{s as fe,b as Y}from"./priceUtils-Dq5SYNCJ.js";function pt(e){const t=L(),n=v(()=>t.getOrderById(e)),r=v(()=>{const o=n.value;if(o)return E.toModel(o)});return{dto:n,model:r}}function ye(e){switch(e){case y.Draft:return"indigo";case y.Cancelled:return"red";case y.Approved:case y.Processing:case y.ReadyForShipment:case y.Shipped:return"warning";case y.Completed:default:return"grey"}}function he(e,t){switch(e){case y.Draft:return t("order.draft");case y.Cancelled:return t("order.cancelled");case y.Approved:return t("order.approved");case y.Processing:return t("order.processing");case y.ReadyForShipment:return t("order.readyForShipment");case y.Shipped:return t("order.shipped");case y.Completed:return t("order.completed")}}function be(e,t){switch(e){case H.Sales:return t("order.sales");case H.Purchase:return t("order.purchase")}}const ft=k({__name:"StatusChip",props:{status:{}},setup(e){const{tCap:t}=B();return(n,r)=>{const o=T("v-chip");return d(),V(o,{color:S(ye)(e.status)},{default:z(()=>[X(R(S(he)(e.status,S(t))),1)]),_:1},8,["color"])}}}),yt=k({__name:"OrderTypeChip",props:{type:{}},setup(e){const{tCap:t}=B();return(n,r)=>{const o=T("v-chip");return d(),V(o,{variant:"outlined"},{default:z(()=>[X(R(S(be)(e.type,S(t))),1)]),_:1})}}});function ge(e){return e.map(t=>({id:t.id,cells:t.cells.map(n=>({value:n}))}))}function ht(e){return e.map(t=>({id:t.id,cells:t.cells.map(n=>n.value)}))}const ve=k({__name:"TextRenderer",props:{modelValue:{},width:{}},setup(e){return(t,n)=>(d(),f("span",{class:"text-renderer",style:M({width:e.width||"1vw"})},R(e.modelValue),5))}}),we=F(ve,[["__scopeId","data-v-1a107f6e"]]),Te=k({__name:"PriceRenderer",props:{modelValue:{},width:{}},setup(e){const t=e,n=v(()=>fe(t.modelValue));return(r,o)=>(d(),f("span",{class:"price-renderer",style:M({width:e.width||"2vw"})},R(n.value),5))}}),Se=F(Te,[["__scopeId","data-v-2b15d027"]]);var _=(e=>(e[e.Up=0]="Up",e[e.Down=1]="Down",e[e.Left=2]="Left",e[e.Right=3]="Right",e))(_||{});function Ce(e,t={}){const{allowArrowNavigation:n=!0}=t;function r(o){let a=null;switch(o.key){case"Enter":a=o.shiftKey?_.Up:_.Down;break;case"Tab":a=o.shiftKey?_.Left:_.Right;break}a&&(o.preventDefault(),o.stopPropagation(),e("navigate",a))}return{onKeydown:r}}function bt(){const e=I(null);q(()=>t());async function t(){await Z(),e.value?.$el?.querySelector("input")?.focus()}return{fieldRef:e}}function xe(e){const t=I(null);q(()=>n()),le(()=>e.value,r=>{r&&n()});async function n(){await Z(),t.value?.$el?.querySelector('input[type="checkbox"]')?.focus()}return{checkboxRef:t}}const Oe=k({__name:"CheckboxRenderer",props:{modelValue:{},width:{},readonly:{type:Boolean},focusKey:{}},emits:["update:modelValue","blur","navigate"],setup(e,{emit:t}){const n=e,r=t,{onKeydown:o}=Ce(r);function a(i){switch(i.key){case" ":i.preventDefault(),r("update:modelValue",!n.modelValue);return;case"Enter":i.preventDefault(),r("navigate",_.Down);return}o(i)}const{checkboxRef:c}=xe(ce(n,"focusKey"));return(i,m)=>{const h=T("v-checkbox");return d(),V(h,{ref_key:"checkboxRef",ref:c,"model-value":!!e.modelValue,"onUpdate:modelValue":m[0]||(m[0]=u=>i.$emit("update:modelValue",u)),density:"compact","hide-details":"",tabindex:"0",onKeydown:a,style:M({width:e.width||"1vw"}),readonly:e.readonly},null,8,["model-value","style","readonly"])}}}),ke={text:we,price:Se,checkbox:Oe},ze={key:0},Ve={key:1},_e={key:2},Re={key:0},Le={key:1},Pe={key:2},$e=k({__name:"BaseTable",props:{modelValue:{},tableColumns:{},hideRowIndex:{type:Boolean},selectable:{type:Boolean},selectedKeys:{},rowKey:{type:Function}},emits:["toggle-row","toggle-all"],setup(e,{emit:t}){const n=e,r=t;function o(i,m,h){return m.calculate?m.calculate(i):h}const a=v(()=>n.selectedKeys&&n.modelValue.length>0&&n.selectedKeys.size===n.modelValue.length),c=v(()=>n.selectedKeys&&n.selectedKeys.size>0&&n.selectedKeys.size<n.modelValue.length);return(i,m)=>{const h=T("v-checkbox"),u=T("v-table");return e.tableColumns.length>0?(d(),V(u,{key:0,class:"base-table",density:"compact",striped:"even"},{default:z(()=>[K("thead",null,[K("tr",null,[e.selectable?(d(),f("th",ze,[O(h,{density:"compact","hide-details":"","model-value":a.value,indeterminate:c.value,"onUpdate:modelValue":m[0]||(m[0]=p=>r("toggle-all"))},null,8,["model-value","indeterminate"])])):x("",!0),e.hideRowIndex!==!0?(d(),f("th",Ve,"#")):x("",!0),(d(!0),f(j,null,D(e.tableColumns,(p,g)=>(d(),f("th",{key:g},R(p.title),1))),128)),i.$slots.actions?(d(),f("th",_e)):x("",!0)])]),K("tbody",null,[(d(!0),f(j,null,D(e.modelValue,(p,g)=>(d(),f("tr",{key:e.rowKey?e.rowKey(p):g},[e.selectable?(d(),f("td",Re,[O(h,{density:"compact","hide-details":"","model-value":e.selectedKeys?.has(e.rowKey(p)),"onUpdate:modelValue":C=>r("toggle-row",e.rowKey(p))},null,8,["model-value","onUpdate:modelValue"])])):x("",!0),e.hideRowIndex!==!0?(d(),f("td",Le,R(g+1),1)):x("",!0),(d(!0),f(j,null,D(p.cells,(C,s)=>G(i.$slots,"cell",{key:s,row:p,column:e.tableColumns[s],cell:C,rowIndex:g,colIndex:s},()=>[e.tableColumns[s].rendererType?(d(),f("td",{key:s},[(d(),V(ue(S(ke)[e.tableColumns[s].rendererType]),{"model-value":o(p,e.tableColumns[s],C.value),width:e.tableColumns[s].width,readonly:!0,"focus-key":0},null,8,["model-value","width"]))])):x("",!0)],!0)),128)),i.$slots.actions?(d(),f("td",Pe,[G(i.$slots,"actions",{row:p,rowIndex:g},void 0,!0)])):x("",!0)]))),128))])]),_:3})):x("",!0)}}}),Ae=F($e,[["__scopeId","data-v-ed062377"]]),Ie=k({__name:"SelectableTable",props:{tableRows:{},tableColumns:{},allSelected:{type:Boolean}},emits:["update:selected"],setup(e,{emit:t}){const n=e,r=v(()=>ge(n.tableRows)),o=t,a=I(new Set);q(()=>{n.allSelected===!0&&m()});function c(u){return u.id??""}function i(u){a.value.has(u)?a.value.delete(u):a.value.add(u),h()}function m(){a.value.size===n.tableRows.length?a.value.clear():n.tableRows.forEach(u=>a.value.add(c(u))),h()}function h(){o("update:selected",n.tableRows.filter(u=>a.value.has(c(u))))}return(u,p)=>(d(),V(Ae,{modelValue:r.value,"table-columns":e.tableColumns,selectable:"","selected-keys":a.value,"row-key":c,onToggleRow:i,onToggleAll:m},null,8,["modelValue","table-columns","selected-keys"]))}}),Ke={name:"productCode",title:"Κωδικός",type:"productCode",editorType:"text",rendererType:"text",navigable:!0,width:"2vw"},De={name:"colour",title:"Χρώμα",type:"variation",editorType:"autocomplete",rendererType:"text",navigable:!0,width:"2.5vw",list:["WILD","F","GLOW","BL","ΚΦ","ΒΕΡ. ΝΑΠΑ","ΣΑ.ΤΖΙΝ","ΣΑ","ΚΝΛ","ΨΗΦ","OL","X","XK","ΤΑΜΠΑ.ΨΑΘΑ","ΓΚΡΙ","ΜΝΤ","ΚΙΤ.ΤΖΙΝ","ΚΦ.ΝΑΙΡ","CAM","LIM.ΚΡ","ROSE.ΚΡ","Χ.ΝΑΠΑ","ΤΑΜΠΑ.ΚΡ","OL.ΚΡ","ΚΥΡ.ΝΑΙΡ","Μ","ΓΚΡΙ.ΝΑΙΡ","ΓΚΡΙ.ΚΡ","ΤΜΠ"]},je={name:"sole",title:"Σόλα",type:"variation",editorType:"autocomplete",rendererType:"text",navigable:!0,width:"2.5vw",list:["anatomic","soft","SOFT","vamos","VAMOS","fiesta","FIESTA","sand","SAND","momo","MOMO","esp"]},Ee={name:"men",title:"Men",type:"flag",rendererType:"checkbox",navigable:!0,width:"1vw"},b="1vw",$=[{name:"shoe:35",title:"35",type:"size",editorType:"number",rendererType:"text",navigable:!0,width:b},{name:"shoe:36",title:"36",type:"size",editorType:"number",rendererType:"text",navigable:!0,width:b},{name:"shoe:37",title:"37",type:"size",editorType:"number",rendererType:"text",navigable:!0,width:b},{name:"shoe:38",title:"38",type:"size",editorType:"number",rendererType:"text",navigable:!0,width:b},{name:"shoe:39",title:"39",type:"size",editorType:"number",rendererType:"text",navigable:!0,width:b},{name:"shoe:40",title:"40",type:"size",editorType:"number",rendererType:"text",navigable:!0,width:b},{name:"shoe:41",title:"41",type:"size",editorType:"number",rendererType:"text",navigable:!0,width:b},{name:"shoe:42",title:"42",type:"size",editorType:"number",rendererType:"text",navigable:!0,width:b},{name:"shoe:43",title:"43",type:"size",editorType:"number",rendererType:"text",navigable:!0,width:b},{name:"shoe:44",title:"44",type:"size",editorType:"number",rendererType:"text",navigable:!0,width:b},{name:"shoe:45",title:"45",type:"size",editorType:"number",rendererType:"text",navigable:!0,width:b},{name:"shoe:46",title:"46",type:"size",editorType:"number",rendererType:"text",navigable:!0,width:b},{name:"shoe:47",title:"47",type:"size",editorType:"number",rendererType:"text",navigable:!0,width:b}],A=[{order:0,...Ke},{order:1,...De},{order:2,...je},{order:3,...Ee},...$.map((e,t)=>({order:t+4,...e})),{order:$.length+4,title:"Τεμάχια",name:"calculated:totalQty",type:"calculated",rendererType:"text",width:"2vw",calculate:ee},{order:$.length+5,title:"Τιμή",name:"variationPrice",type:"price",editorType:"price",rendererType:"price",navigable:!0,width:"2.5vw"},{order:$.length+6,title:"Σύνολο",name:"calculated:totalPrice",type:"calculated",rendererType:"price",width:"3vw",calculate:Be}].sort((e,t)=>e.order-t.order);function ee(e){let t=0;return A.forEach((n,r)=>{n.type==="size"&&(t+=Number(e.cells[r].value)||0)}),t.toString()}function Be(e){const t=Number(ee(e))||0,n=A.findIndex(o=>o.name==="variationPrice");if(n===-1)return"";const r=Number(e.cells[n].value)||0;return(t*r).toString()}function Me(e){const t=e.filter(s=>s.type==="variation"),n=e.filter(s=>s.type==="flag"),r=e.filter(s=>s.type==="size"),o=e.find(s=>s.type==="price"),a=e.find(s=>s.type==="productCode");function c(s){return s.map(l=>({id:l.derivedSku,cells:e.map(w=>r.includes(w)?Fe(l.sizing,w.name):w===o?te(l.unitPrice):w===a?l.productCode:i(l.variationSnapshot,w))}))}function i(s,l){return l.type==="flag"?s.flags?.[l.name]?"true":"":s.attributes?.[l.name]||""}function m(s){return s.map(l=>{const w={attributes:h(l),flags:u(l)},P=p(l),se=g(l),ie=C(l);return{unitPrice:se,productCode:P,variationSnapshot:w,sizing:ie,derivedSku:U(P,w)}})}function h(s){return Object.fromEntries(t.map(l=>[l.name,s.cells[l.order]]))}function u(s){return Object.fromEntries(n.filter(l=>!!s.cells[l.order]).map(l=>[l.name,!0]))}function p(s){return s.cells[e.indexOf(a)]?s.cells[e.indexOf(a)]:""}function g(s){return s.cells[e.indexOf(o)]?Q(s.cells[e.indexOf(o)]):0}function C(s){return Object.fromEntries(r.map(l=>[l.name,Q(s.cells[l.order])]))}return{vmToRows:c,rowsToVm:m}}function Fe(e,t){const n=qe(e,t);return te(n)}function qe(e,t){const n=e[t];return n||0}function Q(e){return e&&e!==""?Number(e):0}function te(e){return e>0?e.toString():""}function ne(e){const t=e.map(Ue);return Ne(t)}function Ue(e){const t=e.sku.variationSnapshot.attributes??{},{size:n,...r}=t;return{name:e.name,unitPrice:e.unitPrice,productCode:e.productCode,derivedSku:U(e.productCode,{attributes:r,flags:e.sku.variationSnapshot.flags}),variationSnapshot:{attributes:r,flags:e.sku.variationSnapshot.flags},sizing:He(n,e.quantity)}}function Ne(e){const t=new Map;for(const n of e){const r=n.derivedSku,o=t.get(r);if(o)for(const[a,c]of Object.entries(n.sizing))o.sizing[a]=(o.sizing[a]||0)+c;else t.set(r,{...n,sizing:{...n.sizing}})}return[...t.values()]}function He(e,t){return{[`shoe:${e}`]:t}}function gt(e){return{partnerId:e.partnerId,vatRate:e.vatRate,dueDate:e.dueDate||void 0,notes:e.notes,depositAmount:e.depositAmount,discountAmount:e.discountAmount,items:re(e.items)}}function re(e){const t=e.flatMap(n=>Ge(n));return We(t).sort((n,r)=>n.derivedSku.localeCompare(r.derivedSku))}function Ge(e,t){const n=Ye(e.sizing),r=Qe(e.variationSnapshot);return n.map(([o,a])=>{const c={attributes:{...r.attributes??{},size:o},flags:r.flags};return{name:e.name,unitPrice:e.unitPrice,productCode:e.productCode,quantity:a,variationSnapshot:c,derivedSku:U(e.productCode,c)}})}function We(e){const t=new Map;for(const n of e){const r=n.derivedSku,o=t.get(r);o?o.quantity+=n.quantity:t.set(r,{...n})}return[...t.values()]}function Ye(e){return Object.entries(e).filter(([t,n])=>n>0).map(([t,n])=>[t.split(":")[1],n])}function Qe(e,t){const n={...Xe(e.attributes)??{}},r={...e.flags??{}};return{...Object.keys(n).length?{attributes:n}:{},...Object.keys(r).length?{flags:r}:{}}}function Xe(e){if(!e)return;const t=Object.fromEntries(Object.entries(e).filter(([n,r])=>r!==""));return Object.keys(t).length>0?t:void 0}const vt=k({__name:"SelectLineItemsModal",props:{modelValue:{type:Boolean},title:{},items:{},action:{type:Function}},emits:["update:model-value"],setup(e,{emit:t}){const{tCap:n}=B(),r=e,o=t,a=I([]),{vmToRows:c,rowsToVm:i}=Me(A),m=v(()=>{const u=ne(r.items);return c(u)});function h(){const u=i(a.value),g=re(u).map(J.toModel);r.action(g),o("update:model-value",!1),a.value=[]}return(u,p)=>{const g=T("v-card-text"),C=T("v-btn"),s=T("v-card-actions"),l=T("v-card"),w=T("v-dialog");return d(),V(w,{"model-value":e.modelValue,"max-width":"1800"},{default:z(()=>[O(l,{title:e.title},{default:z(()=>[O(g,null,{default:z(()=>[O(Ie,{"table-rows":m.value,"table-columns":S(A),"all-selected":!0,selected:a.value,"onUpdate:selected":p[0]||(p[0]=P=>a.value=P)},null,8,["table-rows","table-columns","selected"])]),_:1}),O(s,null,{default:z(()=>[O(C,{variant:"tonal",color:"indigo",text:S(n)("common.exportCsv"),onClick:h},null,8,["text"]),O(C,{text:S(n)("common.cancel"),color:"red",onClick:p[1]||(p[1]=P=>o("update:model-value",!1))},null,8,["text"])]),_:1})]),_:1},8,["title"])]),_:1},8,["model-value"])}}});function Ze(e){const t=L();return v(()=>t.orders.find(n=>n.id===e))}function Je(e){const t=L();return v(()=>t.orders.filter(n=>n.partnerId===e))}class et{static async getNext(t){const n=new Date().getFullYear()%100,r=await N.load(),o=await de.getById(t);if(!o)throw new Error(`Partner with id:${t} doesn't exist`);const a=r.filter(i=>i.partnerId===t);if(a.length===0)return W.create(n,o.clientNumber,1);const c=a.map(i=>i.sequence).filter(i=>i.year===n).sort((i,m)=>i.format().localeCompare(m.format())).at(-1);if(!c)throw new Error("error with find the sequence");return W.create(n,o.clientNumber,c.value+1)}}class tt{constructor(t=L()){this._orderStore=t}async handle(t){const n=t.items.map(J.toModel),r=await et.getNext(t.partnerId),o=me.createIncomingOrder(t.partnerId,r,n,t.vatRate,t.dueDate,t.notes,t.discountAmount,t.depositAmount);await N.add(o),this._orderStore.add(E.toDTO(o))}}class nt{constructor(t=L()){this._orderStore=t}async handle(t){await N.remove(t.id),this._orderStore.remove(t.id)}}function wt(){const e=L(),{allOrders:t}=pe(e);return{allOrders:v(()=>t.value.map(E.toModel)),totalsPerPartner:v(()=>e.totalsPerPartner),globalTotals:v(()=>e.globalTotals),creditOrders:e.creditOrders,debitOrders:e.debitOrders,totalCredited:e.totalCredited,totalDebited:e.totalDebited,balance:e.balance,getOrderById:Ze,getOrdersForPartner:Je,createCreditOrderCommmandHandler:new tt(e),deleteOrderCommmandHandler:new nt(e)}}function Tt(e,t){const n=ot(e);ae(n,`${t}-printlist.csv`)}function St(e,t,n){const r=rt(e,t);ae(r,`${n}-list.csv`)}function rt(e,t){if(!e.length)return"";const n=["MODEL",...t.filter(a=>a.type==="size").map(a=>a.title),"PAIRS","PRICE","TOTAL PRICE"],r=t.filter(a=>a.type==="size"),o=ne(e);return oe(n,o.map(a=>st(a,r)))}function ot(e){return e.length?oe(["MODEL","Size"],e.flatMap(n=>at(n))):""}function oe(e,t){return[e.join(", "),...t].join(`
\r`)}function at(e){const t=it(e),n=e.sku.size,r=`${t}, ${n}`;return Array(e.quantity).fill(r)}function st(e,t){const n=`${e.productCode}${lt(e.variationSnapshot).join(" ")}`,r=t.map(i=>i.name in e.sizing?e.sizing[i.name].toString():"0"),o=Object.values(e.sizing).reduce((i,m)=>i+m,0),a=e.unitPrice,c=o*a;return[n,...r,o,Y(a),Y(c)].join(", ")}function it(e){return`${e.sku.productCode}${e.sku.getSnapshotValues(["size"]).join(" ")}`}function ae(e,t="export.csv"){const n=new Blob([e],{type:"text/csv;charset=utf-8;"}),r=URL.createObjectURL(n),o=document.createElement("a");o.href=r,o.setAttribute("download",t),document.body.appendChild(o),o.click(),document.body.removeChild(o),URL.revokeObjectURL(r)}function lt(e){const t=ct(e.attributes),n=ut(e.flags);return[...t,...n]}function ct(e){return e?Object.entries(e).map(([,t])=>t):[]}function ut(e){return e?Object.entries(e).map(([t])=>t):[]}export{Ae as B,_ as N,we as T,yt as _,ft as a,vt as b,Tt as c,St as d,Ce as e,bt as f,ge as g,Me as h,be as i,pt as j,ne as m,gt as o,ke as r,A as s,ht as t,wt as u};
