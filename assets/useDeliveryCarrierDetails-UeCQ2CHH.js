import{O as n,Q as o,R as y,T as d,U as u,V as l,W as s,X as C,Y as w,C as p,P as m,Z as i,$ as S,a0 as P}from"./index-CnPHzlPR.js";class h{static async getNext(){const e=await n.getAll();if(e.length===0)return 1;const r=e.sort((a,c)=>a.clientNumber-c.clientNumber).map(a=>a.clientNumber).at(-1);if(!r)throw new Error("Could not find last client number");return r+1}}class f{constructor(e=o()){this._partnersStore=e}async handle(e){const r=await h.getNext(),a=y(e.contactName,r,e.activity,e.businessName);return e.email&&e.email.trim()!==""&&a.addEmail(d(e.email,!0)),e.phone&&e.phone.trim()!==""&&a.addPhone(u(e.phone,!0)),e.address&&a.addAddress(l(e.address.street,e.address.city,e.address.zip,e.address.country,!0)),await n.add(a),this._partnersStore.add(s.toDTO(a)),a}}class I{constructor(e=o()){this._partnersStore=e}async handle(e){const r=await h.getNext(),a=C(e.businessName,r,e.deliveryCarrierId,e.contactName);return e.email&&e.email.trim()!=""&&a.addEmail(d(e.email,!0)),e.phone&&e.phone.trim()!=""&&a.addPhone(u(e.phone,!0)),e.address&&a.addAddress(l(e.address.street,e.address.city,e.address.zip,e.address.country,!0)),await n.add(a),this._partnersStore.add(s.toDTO(a)),a}}class B{constructor(e=o()){this._partnersStore=e}async handle(e){const r=await n.getById(e.id);if(r)return r.updateData(e.contactName,e.businessName),await n.update(r),this._partnersStore.update(s.toDTO(r)),r}}class H{constructor(e=o()){this._partnersStore=e}async handle(e){const r=await n.getSupplierById(e.id);if(r)return r.updateData(e.contactName,e.businessName,e.activity),await n.update(r),this._partnersStore.update(s.toDTO(r)),r}}class _{constructor(e=o()){this._partnersStore=e}async handle(e){const r=await n.getB2BCustomerById(e.id);if(r)return r.updateData(e.contactName,e.businessName),r.deliveryCarrierId=e.deliveryCarrierId,await n.update(r),this._partnersStore.update(s.toDTO(r)),r}}class v{constructor(e=o()){this._partnersStore=e}async handle(e){await n.remove(e.id),this._partnersStore.remove(e.id)}}class b{constructor(e=o()){this._partnersStore=e}async handle(e){const r=await n.getById(e.partnerId);if(!r)return;const a=d(e.email,e.isPrimary,e.name);return r.addEmail(a),await n.update(r),this._partnersStore.update(s.toDTO(r)),r}}class g{constructor(e=o()){this._partnersStore=e}async handle(e){const r=await n.getById(e.partnerId);if(!r)return;const a=d(e.email,e.isPrimary,e.name);return r.editEmail(e.emailId,a),await n.update(r),this._partnersStore.update(s.toDTO(r)),r}}class D{constructor(e=o()){this._partnersStore=e}async handle(e){const r=await n.getById(e.partnerId);if(r)return r.removeEmail(e.emailId),await n.update(r),this._partnersStore.update(s.toDTO(r)),r}}class E{constructor(e=o()){this._partnersStore=e}async handle(e){const r=await n.getById(e.partnerId);if(!r)return;const a=u(e.phone,e.isPrimary,e.name);return r.addPhone(a),await n.update(r),this._partnersStore.update(s.toDTO(r)),r}}class N{constructor(e=o()){this._partnersStore=e}async handle(e){const r=await n.getById(e.partnerId);if(!r)return;const a=u(e.phone,e.isPrimary,e.name);return r.editPhone(e.phoneId,a),await n.update(r),this._partnersStore.update(s.toDTO(r)),r}}class A{constructor(e=o()){this._partnersStore=e}async handle(e){const r=await n.getById(e.partnerId);if(r)return r.removePhone(e.phoneId),await n.update(r),this._partnersStore.update(s.toDTO(r)),r}}class T{constructor(e=o()){this._partnersStore=e}async handle(e){const r=await n.getById(e.partnerId);if(!r)return;const a=l(e.street,e.city,e.zip,e.country,e.isPrimary,e.name);return r.addAddress(a),await n.update(r),this._partnersStore.update(s.toDTO(r)),r}}class O{constructor(e=o()){this._partnersStore=e}async handle(e){const r=await n.getById(e.partnerId);if(!r)return;const a=l(e.street,e.city,e.zip,e.country,e.isPrimary,e.name);return r.editAddress(e.addressId,a),await n.update(r),this._partnersStore.update(s.toDTO(r)),r}}class M{constructor(e=o()){this._partnersStore=e}async handle(e){const r=await n.getById(e.partnerId);if(r)return r.removeAddress(e.addressId),await n.update(r),this._partnersStore.update(s.toDTO(r)),r}}function x(){const t=o(),{all:e}=w(t);return{b2bCustomers:p(()=>e.value.filter(r=>r.type===m.B2BCustomer).map(s.toModel)),suppliers:p(()=>e.value.filter(r=>r.type===m.Supplier).map(s.toModel)),createSupplierCommandHandler:new f(t),createB2BCustomerCommandHandler:new I(t),editSupplierCommandHandler:new H(t),editB2BCustomerCommandHandler:new _(t),editPartnerCommandHandler:new B(t),addEmailCommandHandler:new b(t),editEmailCommandHandler:new g(t),removeEmailCommandHandler:new D(t),addPhoneCommandHandler:new E(t),editPhoneCommandHandler:new N(t),removePhoneCommandHandler:new A(t),addAddressCommandHandler:new T(t),editAddressCommandHandler:new O(t),removeAddressCommandHandler:new M(t),deletePartnerCommandHandler:new v(t)}}function z(t,e,r,a){if(!(i(t)&&i(e)&&i(r)&&i(a)))return{id:"",isPrimary:!0,street:t,city:e,zip:r,country:a}}function F(t){if(!t)return;const r=S().getById(t);if(r)return P.toModel(r)}function Q(t){const e=o();return{b2bCustomers:p(()=>e.getByType(m.B2BCustomer).filter(a=>a.deliveryCarrierId===t).map(s.toModel))}}export{F as a,Q as b,z as g,x as u};
