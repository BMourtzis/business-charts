import{a6 as u,aa as w,ab as y}from"./index-CuyDnXgR.js";var a=(e=>(e[e.Draft=0]="Draft",e[e.Confirmed=1]="Confirmed",e[e.Paid=2]="Paid",e[e.Cancelled=3]="Cancelled",e))(a||{}),d=(e=>(e[e.Credit=0]="Credit",e[e.Debit=1]="Debit",e))(d||{});class c{_id;_partnerId;_createdDate;_sentDate;_dueDate;_status;_direction;_items;vatRate;constructor(t,r,i,s,p,D,l,v,h){this._id=t,this._partnerId=r,this._createdDate=v??new Date,this._dueDate=l,this.vatRate=p,this._status=i,this._direction=s,this._items=D.slice(),h&&(this._sentDate=h)}get id(){return this._id}get partnerId(){return this._partnerId}get createdDate(){return this._createdDate}get sentDate(){return this._sentDate}get status(){return this._status}get direction(){return this._direction}get items(){return this._items}get dueDate(){return this._dueDate}get totalAmount(){return this._items.reduce((t,r)=>t+r.totalAmount,0)}addItem(t){if(this.isDraft())throw new Error("Cannot add items to an order that is not in draft status.");this._items.push(t)}updateItem(t,r){if(this.isDraft())throw new Error("Only draft orders can be edited");const i=this._items.find(s=>s.id===t);if(!i)throw new Error("Item not found");r.name&&(i.name=r.name),r.basePrice!==void 0&&i.updateBasePrice(r.basePrice)}setItems(t){if(this.isDraft())throw new Error("Cannot set items to an order that is not in draft status.");this._items=t.slice()}removeItem(t){if(this.isDraft())throw new Error("Cannot remove items to an order that is not in draft status.");const r=this._items.findIndex(i=>i.id===t);r!==-1&&this._items.splice(r,1)}updateStatus(t){if(t!==this._status){if(this.canTransitionTo(t))throw new Error(`Invalid status transition from '${a[this._status]}' to '${a[t]}'.`);this._status=t,this._status===a.Confirmed&&(this._sentDate=new Date)}}canTransitionTo(t){return I[this._status].includes(t)}isDraft(){return this._status===a.Draft}}const I={[a.Draft]:[a.Confirmed],[a.Confirmed]:[a.Paid,a.Cancelled],[a.Paid]:[],[a.Cancelled]:[]};function q(e,t,r,i){return new c(u(),e,a.Draft,d.Debit,r,t,i)}function x(e,t,r,i){return new c(u(),e,a.Draft,d.Credit,r,t,i)}function f(e){return Object.entries(e).sort(([t],[r])=>t.localeCompare(r)).map(([t,r])=>`${t}:${String(r)}`).join("|")}class A{_attributes;quantity;normalizedAttributes;constructor(t,r){if(t<=0)throw new Error("Quantity must be > 0");this._attributes=Object.freeze({...r}),this.quantity=t,this.normalizedAttributes=f(r)}get attributes(){return this._attributes}}class b{_id;_productId;_basePrice;_variations;name;constructor(t,r,i,s){if(this._id=t,this.name=r,this._basePrice=i,s.length===0)throw new Error("OrderItem must have at least one variations");E(s),this._variations=[...s]}get id(){return this._id}get quantity(){return this._variations.reduce((t,r)=>t+r.quantity,0)}get basePrice(){return this._basePrice}get totalAmount(){return this.basePrice*this.quantity}get variations(){return this._variations}updateBasePrice(t){this._basePrice=t}addVariation(t){this.assertEmptyAttributeVariations(t),this.assertDuplicateAttribute(t),this._variations.push(t)}removeVariationByKey(t){const r=this._variations.filter(i=>i.normalizedAttributes!==t);if(r.length===0)throw new Error("OrderItem must have at least one variation");this._variations=r}removeVariationByAttribute(t){this.removeVariationByKey(f(t))}assertEmptyAttributeVariations(t){const r=this._variations.some(n),i=this._variations.some(o);if(r&&o(t)||i&&n(t))throw new Error("You cannot mix empty and non-empty attribute variations")}assertDuplicateAttribute(t){if(this._variations.some(r=>r.normalizedAttributes===t.normalizedAttributes))throw new Error(`Duplicate variation attributes: ${t.normalizedAttributes}`)}}function E(e){if(g(e)&&C(e))throw new Error("You cannot have empty and non-empty attributes in the same orderItem.");const t=e.map(i=>i.normalizedAttributes);if(new Set(t).size!==t.length)throw new Error("Duplicate attributes detected.")}function n(e){return e.normalizedAttributes===""}function o(e){return e.normalizedAttributes!==""}function g(e){return e.some(n)}function C(e){return e.some(o)}function B(e,t,r,i){return new b(u(),e,t,i)}class P{toModel(t){return new A(t.quantity,t.attributes)}toDTO(t){return{quantity:t.quantity,attributes:t.attributes}}}const m=new P;class O{toModel(t){return new b(t.id,t.name,t.basePrice,t.variations.map(m.toModel))}toDTO(t){return{id:t.id,name:t.name,basePrice:t.basePrice,variations:t.variations.map(m.toDTO)}}}const _=new O;class z{toModel(t){return new c(t.id,t.partnerId,t.status,t.direction,t.vatRate,t.items.map(_.toModel),t.dueDate,t.createdDate,t.sentDate)}toDTO(t){return{id:t.id,partnerId:t.partnerId,createdDate:t.createdDate,dueDate:t.dueDate,vatRate:t.vatRate,sentDate:t.sentDate,status:t.status,direction:t.direction,items:t.items.map(_.toDTO)}}}const M=new z;class T extends y{}const R="orders",$=new T(w,M,R);export{M as O,q as a,_ as b,x as c,B as d,$ as o};
