import{a6 as T,C as h,a7 as P,a4 as F,a5 as c,d as C,g as N,m as x,l as S,u as w,q as B,y as q,z as g,o as u,a8 as D,a9 as ee,aa as L,ab as te,ac as re,Z as ne,c as y,$ as I,_ as M,r as K,a as H,n as U,w as ae,G as oe,x as b,B as V,H as z,I as R,a0 as A,a2 as se,a3 as ie}from"./index-DWX8wXUJ.js";import{s as le}from"./priceUtils-1yxS_Q4Z.js";function Ae(e){const t=T(),r=h(()=>t.getOrderById(e)),a=h(()=>{const n=r.value;if(n)return P.toModel(n)});return{dto:r,model:a}}function ue(e){switch(e){case c.Draft:return"indigo";case c.Cancelled:return"red";case c.Approved:case c.Processing:case c.ReadyForShipment:case c.Shipped:return"warning";case c.Completed:default:return"grey"}}function de(e,t){switch(e){case c.Draft:return t("order.draft");case c.Cancelled:return t("order.cancelled");case c.Approved:return t("order.approved");case c.Processing:return t("order.processing");case c.ReadyForShipment:return t("order.readyForShipment");case c.Shipped:return t("order.shipped");case c.Completed:return t("order.completed")}}function ce(e,t){switch(e){case F.Sales:return t("order.sales");case F.Purchase:return t("order.purchase")}}const Ee=C({__name:"StatusChip",props:{status:{}},setup(e){const{tCap:t}=N();return(r,a)=>{const n=S("v-chip");return u(),x(n,{color:w(ue)(e.status)},{default:B(()=>[q(g(w(de)(e.status,w(t))),1)]),_:1},8,["color"])}}}),Ne=C({__name:"OrderTypeChip",props:{type:{}},setup(e){const{tCap:t}=N();return(r,a)=>{const n=S("v-chip");return u(),x(n,{variant:"outlined"},{default:B(()=>[q(g(w(ce)(e.type,w(t))),1)]),_:1})}}});function pe(e){const t=T();return h(()=>t.orders.find(r=>r.id===e))}function me(e){const t=T();return h(()=>t.orders.filter(r=>r.partnerId===e))}class ye{static async getNext(t){const r=new Date().getFullYear()%100,a=await D.load(),n=await ee.getById(t);if(!n)throw new Error(`Partner with id:${t} doesn't exist`);const i=a.filter(l=>l.partnerId===t);if(i.length===0)return L.create(r,n.clientNumber,1);const p=i.map(l=>l.sequence).filter(l=>l.year===r).sort((l,d)=>l.format().localeCompare(d.format())).at(-1);if(!p)throw new Error("error with find the sequence");return L.create(r,n.clientNumber,p.value+1)}}class fe{constructor(t=T()){this._orderStore=t}async handle(t){const r=t.items.map(te.toModel),a=await ye.getNext(t.partnerId),n=re.createIncomingOrder(t.partnerId,a,r,t.vatRate,t.dueDate,t.notes,t.discountAmount,t.depositAmount);await D.add(n),this._orderStore.add(P.toDTO(n))}}class he{constructor(t=T()){this._orderStore=t}async handle(t){await D.remove(t.id),this._orderStore.remove(t.id)}}function qe(){const e=T(),{allOrders:t}=ne(e);return{allOrders:h(()=>t.value.map(P.toModel)),totalsPerPartner:h(()=>e.totalsPerPartner),globalTotals:h(()=>e.globalTotals),creditOrders:e.creditOrders,debitOrders:e.debitOrders,totalCredited:e.totalCredited,totalDebited:e.totalDebited,balance:e.balance,getOrderById:pe,getOrdersForPartner:me,createCreditOrderCommmandHandler:new fe(e),deleteOrderCommmandHandler:new he(e)}}const be=C({__name:"TextRenderer",props:{modelValue:{},width:{}},setup(e){return(t,r)=>(u(),y("span",{class:"text-renderer",style:I({width:e.width||"1vw"})},g(e.modelValue),5))}}),ve=M(be,[["__scopeId","data-v-1a107f6e"]]);var v=(e=>(e[e.Up=0]="Up",e[e.Down=1]="Down",e[e.Left=2]="Left",e[e.Right=3]="Right",e))(v||{});function we(e,t={}){const{allowArrowNavigation:r=!0}=t;function a(n){let i=null;switch(n.key){case"Enter":i=n.shiftKey?v.Up:v.Down;break;case"Tab":i=n.shiftKey?v.Left:v.Right;break}i&&(n.preventDefault(),n.stopPropagation(),e("navigate",i))}return{onKeydown:a}}function Ke(){const e=K(null);H(()=>t());async function t(){await U(),e.value?.$el?.querySelector("input")?.focus()}return{fieldRef:e}}function ge(e){const t=K(null);H(()=>r()),ae(()=>e.value,a=>{a&&r()});async function r(){await U(),t.value?.$el?.querySelector('input[type="checkbox"]')?.focus()}return{checkboxRef:t}}function He(e){return e.map(t=>({id:t.id,cells:t.cells.map(r=>({value:r}))}))}function Ue(e){return e.map(t=>({id:t.id,cells:t.cells.map(r=>r.value)}))}const Te=C({__name:"PriceRenderer",props:{modelValue:{},width:{}},setup(e){const t=e,r=h(()=>le(t.modelValue));return(a,n)=>(u(),y("span",{class:"price-renderer",style:I({width:e.width||"2vw"})},g(r.value),5))}}),Ce=M(Te,[["__scopeId","data-v-2b15d027"]]),xe=C({__name:"CheckboxRenderer",props:{modelValue:{},width:{},readonly:{type:Boolean},focusKey:{}},emits:["update:modelValue","blur","navigate"],setup(e,{emit:t}){const r=e,a=t,{onKeydown:n}=we(a);function i(l){switch(l.key){case" ":l.preventDefault(),a("update:modelValue",!r.modelValue);return;case"Enter":l.preventDefault(),a("navigate",v.Down);return}n(l)}const{checkboxRef:p}=ge(oe(r,"focusKey"));return(l,d)=>{const _=S("v-checkbox");return u(),x(_,{ref_key:"checkboxRef",ref:p,"model-value":!!e.modelValue,"onUpdate:modelValue":d[0]||(d[0]=k=>l.$emit("update:modelValue",k)),density:"compact","hide-details":"",tabindex:"0",onKeydown:i,style:I({width:e.width||"1vw"}),readonly:e.readonly},null,8,["model-value","style","readonly"])}}}),Oe={text:ve,price:Ce,checkbox:xe},Se={key:0},_e={key:1},ke={key:0},Ve={key:1},ze=C({__name:"BaseTable",props:{modelValue:{},tableColumns:{},hideRowIndex:{type:Boolean}},setup(e){function t(r,a,n){return a.calculate?a.calculate(r):n}return(r,a)=>{const n=S("v-table");return e.tableColumns.length>0?(u(),x(n,{key:0,class:"base-table",density:"compact",striped:"even"},{default:B(()=>[V("thead",null,[V("tr",null,[e.hideRowIndex!==!0?(u(),y("th",Se,"#")):b("",!0),(u(!0),y(R,null,z(e.tableColumns,(i,p)=>(u(),y("th",{key:p},g(i.title),1))),128)),r.$slots.actions?(u(),y("th",_e)):b("",!0)])]),V("tbody",null,[(u(!0),y(R,null,z(e.modelValue,(i,p)=>(u(),y("tr",{key:p},[e.hideRowIndex!==!0?(u(),y("td",ke,g(p+1),1)):b("",!0),(u(!0),y(R,null,z(i.cells,(l,d)=>A(r.$slots,"cell",{key:d,row:i,column:e.tableColumns[d],cell:l,rowIndex:p,colIndex:d},()=>[e.tableColumns[d].rendererType?(u(),y("td",{key:d},[(u(),x(se(w(Oe)[e.tableColumns[d].rendererType]),{"model-value":t(i,e.tableColumns[d],l.value),width:e.tableColumns[d].width,readonly:!0},null,8,["model-value","width"]))])):b("",!0)],!0)),128)),r.$slots.actions?(u(),y("td",Ve,[A(r.$slots,"actions",{row:i,rowIndex:p},void 0,!0)])):b("",!0)]))),128))])]),_:3})):b("",!0)}}}),je=M(ze,[["__scopeId","data-v-49e33c71"]]),Re={name:"productCode",title:"Κωδικός",type:"productCode",editorType:"text",rendererType:"text",navigable:!0,width:"2vw"},Pe={name:"colour",title:"Χρώμα",type:"variation",editorType:"autocomplete",rendererType:"text",navigable:!0,width:"2.5vw",list:["WILD","F","GLOW","BL","ΚΦ","ΒΕΡ. ΝΑΠΑ","ΣΑ.ΤΖΙΝ","ΣΑ","ΚΝΛ","ΨΗΦ","OL","X","XK","ΤΑΜΠΑ.ΨΑΘΑ","ΓΚΡΙ","ΜΝΤ","ΚΙΤ.ΤΖΙΝ","ΚΦ.ΝΑΙΡ","CAM","LIM.ΚΡ","ROSE.ΚΡ","Χ.ΝΑΠΑ","ΤΑΜΠΑ.ΚΡ","OL.ΚΡ","ΚΥΡ.ΝΑΙΡ","Μ","ΓΚΡΙ.ΝΑΙΡ","ΓΚΡΙ.ΚΡ"]},Be={name:"sole",title:"Σόλα",type:"variation",editorType:"autocomplete",rendererType:"text",navigable:!0,width:"2.5vw",list:["anatomic","soft","SOFT","vamos","VAMOS","fiesta","FIESTA","sand","SAND","momo","MOMO","esp"]},De={name:"men",title:"Men",type:"flag",rendererType:"checkbox",navigable:!0,width:"1vw"},m="1vw",O=[{name:"shoe:35",title:"35",type:"size",editorType:"number",rendererType:"text",navigable:!0,width:m},{name:"shoe:36",title:"36",type:"size",editorType:"number",rendererType:"text",navigable:!0,width:m},{name:"shoe:37",title:"37",type:"size",editorType:"number",rendererType:"text",navigable:!0,width:m},{name:"shoe:38",title:"38",type:"size",editorType:"number",rendererType:"text",navigable:!0,width:m},{name:"shoe:39",title:"39",type:"size",editorType:"number",rendererType:"text",navigable:!0,width:m},{name:"shoe:40",title:"40",type:"size",editorType:"number",rendererType:"text",navigable:!0,width:m},{name:"shoe:41",title:"41",type:"size",editorType:"number",rendererType:"text",navigable:!0,width:m},{name:"shoe:42",title:"42",type:"size",editorType:"number",rendererType:"text",navigable:!0,width:m},{name:"shoe:43",title:"43",type:"size",editorType:"number",rendererType:"text",navigable:!0,width:m},{name:"shoe:44",title:"44",type:"size",editorType:"number",rendererType:"text",navigable:!0,width:m},{name:"shoe:45",title:"45",type:"size",editorType:"number",rendererType:"text",navigable:!0,width:m},{name:"shoe:46",title:"46",type:"size",editorType:"number",rendererType:"text",navigable:!0,width:m},{name:"shoe:47",title:"47",type:"size",editorType:"number",rendererType:"text",navigable:!0,width:m}],j=[{order:0,...Re},{order:1,...Pe},{order:2,...Be},{order:3,...De},...O.map((e,t)=>({order:t+4,...e})),{order:O.length+4,title:"Τεμάχια",name:"calculated:totalQty",type:"calculated",rendererType:"text",width:"2vw",calculate:G},{order:O.length+5,title:"Τιμή",name:"variationPrice",type:"price",editorType:"price",rendererType:"price",navigable:!0,width:"2.5vw"},{order:O.length+6,title:"Σύνολο",name:"calculated:totalPrice",type:"calculated",rendererType:"price",width:"3vw",calculate:Ie}].sort((e,t)=>e.order-t.order);function G(e){let t=0;return j.forEach((r,a)=>{r.type==="size"&&(t+=Number(e.cells[a].value)||0)}),t.toString()}function Ie(e){const t=Number(G(e))||0,r=j.findIndex(n=>n.name==="variationPrice");if(r===-1)return"";const a=Number(e.cells[r].value)||0;return(t*a).toString()}function Ge(e){const t=e.filter(o=>o.type==="variation"),r=e.filter(o=>o.type==="flag"),a=e.filter(o=>o.type==="size"),n=e.find(o=>o.type==="price"),i=e.find(o=>o.type==="productCode");function p(o){return o.map(s=>({cells:e.map(f=>a.includes(f)?Me(s.sizing,f.name):f===n?W(s.unitPrice):f===i?s.productCode:l(s.variationSnapshot,f))}))}function l(o,s){return s.type==="flag"?o.flags?.[s.name]?"true":"":o.attributes?.[s.name]||""}function d(o){return o.map(s=>{const f={attributes:_(s),flags:k(s)},$=Y(s),Z=Q(s),J=X(s);return{unitPrice:Z,productCode:$,variationSnapshot:f,sizing:J,derivedSku:ie($,f)}})}function _(o){return Object.fromEntries(t.map(s=>[s.name,o.cells[s.order]]))}function k(o){return Object.fromEntries(r.filter(s=>!!o.cells[s.order]).map(s=>[s.name,!0]))}function Y(o){return o.cells[e.indexOf(i)]?o.cells[e.indexOf(i)]:""}function Q(o){return o.cells[e.indexOf(n)]?E(o.cells[e.indexOf(n)]):0}function X(o){return Object.fromEntries(a.map(s=>[s.name,E(o.cells[s.order])]))}return{vmToRows:p,rowsToVm:d}}function Me(e,t){const r=$e(e,t);return W(r)}function $e(e,t){const r=e[t];return r||0}function E(e){return e&&e!==""?Number(e):0}function W(e){return e>0?e.toString():""}export{je as B,v as N,ve as T,Ne as _,Ee as a,we as b,Ke as c,He as d,Ge as e,Ae as f,ce as g,Oe as r,j as s,Ue as t,qe as u};
