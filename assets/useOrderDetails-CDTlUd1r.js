import{a9 as c,C as s,aa as l,O as h,ab as m,ac as S,ad as w,ae as b,af as p,Y as f,Q as y,g as D,ag as C,ah as a,a8 as g}from"./index-5v3h8jPH.js";function P(r){const e=c();return s(()=>e.orders.find(t=>t.id===r))}function v(r){const e=c();return s(()=>e.orders.filter(t=>t.partnerId===r))}class I{static async getNext(e){const t=new Date().getFullYear()%100,o=await l.load(),n=await h.getById(e);if(!n)throw new Error(`Partner with id:${e} doesn't exist`);const u=o.filter(d=>d.partnerId===e);if(u.length===0)return m.create(t,n.clientNumber,1);const i=u.map(d=>d.sequence).filter(d=>d.year===t).sort((d,O)=>d.format().localeCompare(O.format())).at(-1);if(!i)throw new Error("error with find the sequence");return m.create(t,n.clientNumber,i.value+1)}}class T{constructor(e=c()){this._orderStore=e}async handle(e){const t=e.items.map(u=>S(u.name,u.variations.map(i=>new w(i.quantity,i.price,i.attributes)))),o=await I.getNext(e.partnerId),n=b(e.partnerId,o,t,e.vatRate,e.dueDate,e.notes,e.discountAmount,e.depositAmount);await l.add(n),this._orderStore.add(p.toDTO(n))}}class N{constructor(e=c()){this._orderStore=e}async handle(e){await l.remove(e.id),this._orderStore.remove(e.id)}}function F(){const r=c(),{allOrders:e}=f(r),t=y(),{all:o}=f(t),{tCap:n}=D();return{allOrders:s(()=>e.value.map(p.toModel)),partners:s(()=>o.value),totalsPerPartner:s(()=>r.totalsPerPartner),globalTotals:s(()=>r.globalTotals),creditOrders:r.creditOrders,debitOrders:r.debitOrders,totalCredited:r.totalCredited,totalDebited:r.totalDebited,balance:r.balance,partnersToItemProps:R(n),getOrderById:P,getOrdersForPartner:v,createCreditOrderCommmandHandler:new T(r),deleteOrderCommmandHandler:new N(r)}}function R(r){return e=>{if(e)return{title:e.businessName||e.contactName,value:e.id,subtitle:r(C(e.type))}}}function x(r){const e=c(),t=s(()=>e.getOrderById(r)),o=s(()=>{const n=t.value;if(n)return p.toModel(n)});return{dto:t,model:o}}function A(r){switch(r){case a.Draft:return"indigo";case a.Cancelled:return"red";case a.Approved:case a.Processing:case a.ReadyForShipment:case a.Shipped:return"warning";case a.Completed:default:return"grey"}}function H(r){return r.toLocaleDateString()}function Y(r){return`${r.toFixed(2)}â‚¬`}function _(r,e){switch(r){case a.Draft:return e("order.draft");case a.Cancelled:return e("order.cancelled");case a.Approved:return e("order.approved");case a.Processing:return e("order.processing");case a.ReadyForShipment:return e("order.readyForShipment");case a.Shipped:return e("order.shipped");case a.Completed:return e("order.completed")}}function B(r,e){switch(r){case g.Credit:return e("common.credit");case g.Debit:return e("common.debit")}}export{_ as a,H as b,Y as c,x as d,B as g,A as s,F as u};
