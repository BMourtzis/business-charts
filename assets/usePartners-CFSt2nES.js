import{af as n,R as o,ao as y,X as u,Y as p,V as l,T as s,ap as C,Z as w,g as P,C as m,P as i,aq as d}from"./index-GJmNcSpu.js";class c{static async getNext(){const e=await n.getAll();if(e.length===0)return 1;const r=e.sort((a,h)=>a.clientNumber-h.clientNumber).map(a=>a.clientNumber).at(-1);if(!r)throw new Error("Could not find last client number");return r+1}}class S{constructor(e=o()){this._partnersStore=e}async handle(e){const r=await c.getNext(),a=y(e.contactName,r,e.activity,e.businessName);return e.email&&e.email.trim()!==""&&a.addEmail(u(e.email,!0)),e.phone&&e.phone.trim()!==""&&a.addPhone(p(e.phone,!0)),e.address&&a.addAddress(l(e.address.street,e.address.city,e.address.zip,e.address.country,!0)),await n.add(a),this._partnersStore.add(s.toDTO(a)),a}}class I{constructor(e=o()){this._partnersStore=e}async handle(e){const r=await c.getNext(),a=C(e.businessName,r,e.deliveryCarrierId,e.contactName);return e.email&&e.email.trim()!=""&&a.addEmail(u(e.email,!0)),e.phone&&e.phone.trim()!=""&&a.addPhone(p(e.phone,!0)),e.address&&a.addAddress(l(e.address.street,e.address.city,e.address.zip,e.address.country,!0)),await n.add(a),this._partnersStore.add(s.toDTO(a)),a}}class f{constructor(e=o()){this._partnersStore=e}async handle(e){const r=await n.getById(e.id);if(r)return r.updateData(e.contactName,e.businessName),await n.update(r),this._partnersStore.update(s.toDTO(r)),r}}class H{constructor(e=o()){this._partnersStore=e}async handle(e){const r=await n.getSupplierById(e.id);if(r)return r.updateData(e.contactName,e.businessName,e.activity),await n.update(r),this._partnersStore.update(s.toDTO(r)),r}}class _{constructor(e=o()){this._partnersStore=e}async handle(e){const r=await n.getB2BCustomerById(e.id);if(r)return r.updateData(e.contactName,e.businessName),r.deliveryCarrierId=e.deliveryCarrierId,await n.update(r),this._partnersStore.update(s.toDTO(r)),r}}class B{constructor(e=o()){this._partnersStore=e}async handle(e){await n.remove(e.id),this._partnersStore.remove(e.id)}}class g{constructor(e=o()){this._partnersStore=e}async handle(e){const r=await n.getById(e.partnerId);if(!r)return;const a=u(e.email,e.isPrimary,e.name);return r.addEmail(a),await n.update(r),this._partnersStore.update(s.toDTO(r)),r}}class N{constructor(e=o()){this._partnersStore=e}async handle(e){const r=await n.getById(e.partnerId);if(!r)return;const a=u(e.email,e.isPrimary,e.name);return r.editEmail(e.emailId,a),await n.update(r),this._partnersStore.update(s.toDTO(r)),r}}class v{constructor(e=o()){this._partnersStore=e}async handle(e){const r=await n.getById(e.partnerId);if(r)return r.removeEmail(e.emailId),await n.update(r),this._partnersStore.update(s.toDTO(r)),r}}class T{constructor(e=o()){this._partnersStore=e}async handle(e){const r=await n.getById(e.partnerId);if(!r)return;const a=p(e.phone,e.isPrimary,e.name);return r.addPhone(a),await n.update(r),this._partnersStore.update(s.toDTO(r)),r}}class b{constructor(e=o()){this._partnersStore=e}async handle(e){const r=await n.getById(e.partnerId);if(!r)return;const a=p(e.phone,e.isPrimary,e.name);return r.editPhone(e.phoneId,a),await n.update(r),this._partnersStore.update(s.toDTO(r)),r}}class E{constructor(e=o()){this._partnersStore=e}async handle(e){const r=await n.getById(e.partnerId);if(r)return r.removePhone(e.phoneId),await n.update(r),this._partnersStore.update(s.toDTO(r)),r}}class A{constructor(e=o()){this._partnersStore=e}async handle(e){const r=await n.getById(e.partnerId);if(!r)return;const a=l(e.street,e.city,e.zip,e.country,e.isPrimary,e.name);return r.addAddress(a),await n.update(r),this._partnersStore.update(s.toDTO(r)),r}}class D{constructor(e=o()){this._partnersStore=e}async handle(e){const r=await n.getById(e.partnerId);if(!r)return;const a=l(e.street,e.city,e.zip,e.country,e.isPrimary,e.name);return r.editAddress(e.addressId,a),await n.update(r),this._partnersStore.update(s.toDTO(r)),r}}class O{constructor(e=o()){this._partnersStore=e}async handle(e){const r=await n.getById(e.partnerId);if(r)return r.removeAddress(e.addressId),await n.update(r),this._partnersStore.update(s.toDTO(r)),r}}function F(){const t=o(),{all:e}=w(t),{tCap:r}=P();return{b2bCustomers:m(()=>e.value.filter(a=>a.type===i.B2BCustomer).map(s.toModel)),suppliers:m(()=>e.value.filter(a=>a.type===i.Supplier).map(s.toModel)),partners:m(()=>e.value),partnersToItemProps:R(r),createSupplierCommandHandler:new S(t),createB2BCustomerCommandHandler:new I(t),editSupplierCommandHandler:new H(t),editB2BCustomerCommandHandler:new _(t),editPartnerCommandHandler:new f(t),addEmailCommandHandler:new g(t),editEmailCommandHandler:new N(t),removeEmailCommandHandler:new v(t),addPhoneCommandHandler:new T(t),editPhoneCommandHandler:new b(t),removePhoneCommandHandler:new E(t),addAddressCommandHandler:new A(t),editAddressCommandHandler:new D(t),removeAddressCommandHandler:new O(t),deletePartnerCommandHandler:new B(t)}}function R(t){return e=>{if(e)return{title:e.businessName||e.contactName,value:e.id,subtitle:t(x(e.type))}}}function x(t){return z[t]}const z={[i.Supplier]:"partner.supplier",[i.B2BCustomer]:"partner.b2bCustomer",[i.RetailCustomer]:"partner.customer",[i.Contractor]:"partner.contractor"};function q(t,e,r,a){if(!(d(t)&&d(e)&&d(r)&&d(a)))return{id:"",isPrimary:!0,street:t,city:e,zip:r,country:a}}export{q as g,F as u};
