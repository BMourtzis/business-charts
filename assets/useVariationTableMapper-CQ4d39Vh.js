import{aa as T,C as f,ab as R,O as te,ac as F,ad as re,ae as ne,af as D,Y as M,Q as ae,g as L,ag as oe,a8 as A,a9 as p,d as C,m as x,l as S,u as v,q as I,y as U,z as w,o as c,c as y,a3 as B,_ as N,r as se,w as ie,n as le,x as b,B as P,I as V,J as z,a4 as E,a6 as ce,a7 as ue}from"./index-Bf_LNgB1.js";function de(e){const t=T();return f(()=>t.orders.find(r=>r.id===e))}function pe(e){const t=T();return f(()=>t.orders.filter(r=>r.partnerId===e))}class me{static async getNext(t){const r=new Date().getFullYear()%100,a=await R.load(),n=await te.getById(t);if(!n)throw new Error(`Partner with id:${t} doesn't exist`);const l=a.filter(i=>i.partnerId===t);if(l.length===0)return F.create(r,n.clientNumber,1);const d=l.map(i=>i.sequence).filter(i=>i.year===r).sort((i,u)=>i.format().localeCompare(u.format())).at(-1);if(!d)throw new Error("error with find the sequence");return F.create(r,n.clientNumber,d.value+1)}}class ye{constructor(t=T()){this._orderStore=t}async handle(t){const r=t.items.map(re.toModel),a=await me.getNext(t.partnerId),n=ne.createIncomingOrder(t.partnerId,a,r,t.vatRate,t.dueDate,t.notes,t.discountAmount,t.depositAmount);await R.add(n),this._orderStore.add(D.toDTO(n))}}class fe{constructor(t=T()){this._orderStore=t}async handle(t){await R.remove(t.id),this._orderStore.remove(t.id)}}function qe(){const e=T(),{allOrders:t}=M(e),r=ae(),{all:a}=M(r),{tCap:n}=L();return{allOrders:f(()=>t.value.map(D.toModel)),partners:f(()=>a.value),totalsPerPartner:f(()=>e.totalsPerPartner),globalTotals:f(()=>e.globalTotals),creditOrders:e.creditOrders,debitOrders:e.debitOrders,totalCredited:e.totalCredited,totalDebited:e.totalDebited,balance:e.balance,partnersToItemProps:he(n),getOrderById:de,getOrdersForPartner:pe,createCreditOrderCommmandHandler:new ye(e),deleteOrderCommmandHandler:new fe(e)}}function he(e){return t=>{if(t)return{title:t.businessName||t.contactName,value:t.id,subtitle:e(oe(t.type))}}}function be(e){const t=parseFloat(e);return H(t)}function H(e){if(isNaN(e))return`0,00${q()}`;const t=e.toFixed(2);return`${j(t)}${q()}`}function Ke(e){return j(e)}function Ue(e){return ge(e)}function j(e){return e.replace(".",",")}function ge(e){return e.replace(",",".")}function q(){return"€"}function He(e){const t=T(),r=f(()=>t.getOrderById(e)),a=f(()=>{const n=r.value;if(n)return D.toModel(n)});return{dto:r,model:a}}function ve(e){switch(e){case p.Draft:return"indigo";case p.Cancelled:return"red";case p.Approved:case p.Processing:case p.ReadyForShipment:case p.Shipped:return"warning";case p.Completed:default:return"grey"}}function je(e){return e.toLocaleDateString()}function Ge(e){return H(e)}function we(e,t){switch(e){case p.Draft:return t("order.draft");case p.Cancelled:return t("order.cancelled");case p.Approved:return t("order.approved");case p.Processing:return t("order.processing");case p.ReadyForShipment:return t("order.readyForShipment");case p.Shipped:return t("order.shipped");case p.Completed:return t("order.completed")}}function Te(e,t){switch(e){case A.Sales:return t("order.sales");case A.Purchase:return t("order.purchase")}}const Ye=C({__name:"StatusChip",props:{status:{}},setup(e){const{tCap:t}=L();return(r,a)=>{const n=S("v-chip");return c(),x(n,{color:v(ve)(e.status)},{default:I(()=>[U(w(v(we)(e.status,v(t))),1)]),_:1},8,["color"])}}}),Qe=C({__name:"OrderTypeChip",props:{type:{}},setup(e){const{tCap:t}=L();return(r,a)=>{const n=S("v-chip");return c(),x(n,{variant:"outlined"},{default:I(()=>[U(w(v(Te)(e.type,v(t))),1)]),_:1})}}}),Ce=C({__name:"TextRenderer",props:{modelValue:{},width:{}},setup(e){return(t,r)=>(c(),y("span",{class:"text-renderer",style:B({width:e.width||"1vw"})},w(e.modelValue),5))}}),xe=N(Ce,[["__scopeId","data-v-1a107f6e"]]);var g=(e=>(e[e.Up=0]="Up",e[e.Down=1]="Down",e[e.Left=2]="Left",e[e.Right=3]="Right",e))(g||{});function Oe(e,t={}){const{allowArrowNavigation:r=!0}=t;function a(n){let l=null;switch(n.key){case"Enter":l=n.shiftKey?g.Up:g.Down;break;case"Tab":l=n.shiftKey?g.Left:g.Right;break}l!==null&&(n.preventDefault(),e("navigate",l))}return{onKeydown:a}}function We(e){return e.map(t=>({id:t.id,cells:t.cells.map(r=>({value:r}))}))}function Xe(e){return e.map(t=>({id:t.id,cells:t.cells.map(r=>r.value)}))}const Se=C({__name:"PriceRenderer",props:{modelValue:{},width:{}},setup(e){const t=e,r=f(()=>be(t.modelValue));return(a,n)=>(c(),y("span",{class:"price-renderer",style:B({width:e.width||"2vw"})},w(r.value),5))}}),_e=N(Se,[["__scopeId","data-v-2b15d027"]]),ke=C({__name:"CheckboxRenderer",props:{modelValue:{},focused:{type:Boolean},width:{},readonly:{type:Boolean}},emits:["update:modelValue","blur","navigate"],setup(e,{emit:t}){const r=e,a=t,{onKeydown:n}=Oe(a);function l(i){switch(i.key){case" ":i.preventDefault(),a("update:modelValue",!r.modelValue);return;case"Enter":i.preventDefault(),a("update:modelValue",!r.modelValue),a("navigate",g.Down);return}n(i)}const d=se(null);return ie(()=>r.focused,async i=>{i&&(await le(),d.value?.$el?.querySelector('input[type="checkbox"]')?.focus())}),(i,u)=>{const _=S("v-checkbox");return c(),x(_,{ref_key:"checkboxRef",ref:d,"model-value":!!e.modelValue,"onUpdate:modelValue":u[0]||(u[0]=k=>i.$emit("update:modelValue",k)),density:"compact","hide-details":"",tabindex:"0",onKeydown:l,style:B({width:e.width||"1vw"}),readonly:e.readonly},null,8,["model-value","style","readonly"])}}}),Pe={text:xe,price:_e,checkbox:ke},Ve={key:0},ze={key:1},Re={key:0},De={key:1},Le=C({__name:"BaseTable",props:{modelValue:{},tableColumns:{},hideRowIndex:{type:Boolean}},setup(e){function t(r,a,n){return a.calculate?a.calculate(r):n}return(r,a)=>{const n=S("v-table");return e.tableColumns.length>0?(c(),x(n,{key:0,class:"base-table",density:"compact",striped:"even"},{default:I(()=>[P("thead",null,[P("tr",null,[e.hideRowIndex!==!0?(c(),y("th",Ve,"#")):b("",!0),(c(!0),y(z,null,V(e.tableColumns,(l,d)=>(c(),y("th",{key:d},w(l.title),1))),128)),r.$slots.actions?(c(),y("th",ze)):b("",!0)])]),P("tbody",null,[(c(!0),y(z,null,V(e.modelValue,(l,d)=>(c(),y("tr",{key:d},[e.hideRowIndex!==!0?(c(),y("td",Re,w(d+1),1)):b("",!0),(c(!0),y(z,null,V(l.cells,(i,u)=>E(r.$slots,"cell",{key:u,row:l,column:e.tableColumns[u],cell:i,rowIndex:d,colIndex:u},()=>[e.tableColumns[u].rendererType?(c(),y("td",{key:u},[(c(),x(ce(v(Pe)[e.tableColumns[u].rendererType]),{"model-value":t(l,e.tableColumns[u],i.value),width:e.tableColumns[u].width,readonly:!0},null,8,["model-value","width"]))])):b("",!0)],!0)),128)),r.$slots.actions?(c(),y("td",De,[E(r.$slots,"actions",{row:l,rowIndex:d},void 0,!0)])):b("",!0)]))),128))])]),_:3})):b("",!0)}}}),Je=N(Le,[["__scopeId","data-v-49e33c71"]]),Ie={name:"productCode",title:"Κωδικός",type:"productCode",editorType:"text",rendererType:"text",navigable:!0,width:"2vw"},Be={name:"colour",title:"Χρώμα",type:"variation",editorType:"autocomplete",rendererType:"text",navigable:!0,width:"2.5vw",list:["WILD","F","GLOW","BL","ΚΦ","ΒΕΡ. ΝΑΠΑ","ΣΑ.ΤΖΙΝ","ΣΑ","ΚΝΛ","ΨΗΦ","OL","X","XK","ΤΑΜΠΑ.ΨΑΘΑ","ΓΚΡΙ","ΜΝΤ","ΚΙΤ.ΤΖΙΝ","ΚΦ.ΝΑΙΡ","CAM","LIM.ΚΡ","ROSE.ΚΡ","Χ.ΝΑΠΑ","ΤΑΜΠΑ.ΚΡ","OL.ΚΡ","ΚΥΡ.ΝΑΙΡ","Μ","ΓΚΡΙ.ΝΑΙΡ","ΓΚΡΙ.ΚΡ"]},Ne={name:"sole",title:"Σόλα",type:"variation",editorType:"autocomplete",rendererType:"text",navigable:!0,width:"2.5vw",list:["anatomic","soft","SOFT","vamos","VAMOS","fiesta","FIESTA","sand","SAND","momo","MOMO","esp"]},$e={name:"men",title:"Men",type:"flag",rendererType:"checkbox",navigable:!0,width:"1vw"},m="1vw",O=[{name:"shoe:35",title:"35",type:"size",editorType:"number",rendererType:"text",navigable:!0,width:m},{name:"shoe:36",title:"36",type:"size",editorType:"number",rendererType:"text",navigable:!0,width:m},{name:"shoe:37",title:"37",type:"size",editorType:"number",rendererType:"text",navigable:!0,width:m},{name:"shoe:38",title:"38",type:"size",editorType:"number",rendererType:"text",navigable:!0,width:m},{name:"shoe:39",title:"39",type:"size",editorType:"number",rendererType:"text",navigable:!0,width:m},{name:"shoe:40",title:"40",type:"size",editorType:"number",rendererType:"text",navigable:!0,width:m},{name:"shoe:41",title:"41",type:"size",editorType:"number",rendererType:"text",navigable:!0,width:m},{name:"shoe:42",title:"42",type:"size",editorType:"number",rendererType:"text",navigable:!0,width:m},{name:"shoe:43",title:"43",type:"size",editorType:"number",rendererType:"text",navigable:!0,width:m},{name:"shoe:44",title:"44",type:"size",editorType:"number",rendererType:"text",navigable:!0,width:m},{name:"shoe:45",title:"45",type:"size",editorType:"number",rendererType:"text",navigable:!0,width:m},{name:"shoe:46",title:"46",type:"size",editorType:"number",rendererType:"text",navigable:!0,width:m},{name:"shoe:47",title:"47",type:"size",editorType:"number",rendererType:"text",navigable:!0,width:m}],G=[{order:0,...Ie},{order:1,...Be},{order:2,...Ne},{order:3,...$e},...O.map((e,t)=>({order:t+4,...e})),{order:O.length+4,title:"Τεμάχια",name:"calculated:totalQty",type:"calculated",rendererType:"text",width:"2vw",calculate:Y},{order:O.length+5,title:"Τιμή",name:"variationPrice",type:"price",editorType:"price",rendererType:"price",navigable:!0,width:"2.5vw"},{order:O.length+6,title:"Σύνολο",name:"calculated:totalPrice",type:"calculated",rendererType:"price",width:"3vw",calculate:Fe}].sort((e,t)=>e.order-t.order);function Y(e){let t=0;return G.forEach((r,a)=>{r.type==="size"&&(t+=Number(e.cells[a].value)||0)}),t.toString()}function Fe(e){const t=Number(Y(e))||0,r=G.findIndex(n=>n.name==="variationPrice");if(r===-1)return"";const a=Number(e.cells[r].value)||0;return(t*a).toString()}function Ze(e){const t=e.filter(o=>o.type==="variation"),r=e.filter(o=>o.type==="flag"),a=e.filter(o=>o.type==="size"),n=e.find(o=>o.type==="price"),l=e.find(o=>o.type==="productCode");function d(o){return o.map(s=>({cells:e.map(h=>a.includes(h)?Me(s.sizing,h.name):h===n?Q(s.unitPrice):h===l?s.productCode:i(s.variationSnapshot,h))}))}function i(o,s){return s.type==="flag"?o.flags?.[s.name]?"true":"":o.attributes?.[s.name]||""}function u(o){return o.map(s=>{const h={attributes:_(s),flags:k(s)},$=W(s),Z=X(s),ee=J(s);return{unitPrice:Z,productCode:$,variationSnapshot:h,sizing:ee,derivedSku:ue($,h)}})}function _(o){return Object.fromEntries(t.map(s=>[s.name,o.cells[s.order]]))}function k(o){return Object.fromEntries(r.filter(s=>!!o.cells[s.order]).map(s=>[s.name,!0]))}function W(o){return o.cells[e.indexOf(l)]?o.cells[e.indexOf(l)]:""}function X(o){return o.cells[e.indexOf(n)]?K(o.cells[e.indexOf(n)]):0}function J(o){return Object.fromEntries(a.map(s=>[s.name,K(o.cells[s.order])]))}return{vmToRows:d,rowsToVm:u}}function Me(e,t){const r=Ae(e,t);return Q(r)}function Ae(e,t){const r=e[t];return r||0}function K(e){return e&&e!==""?Number(e):0}function Q(e){return e>0?e.toString():""}export{Je as B,g as N,xe as T,Qe as _,Ye as a,Oe as b,Ue as c,We as d,Ze as e,Te as f,q as g,je as h,Ke as i,Ge as j,He as k,H as n,Pe as r,G as s,Xe as t,qe as u};
